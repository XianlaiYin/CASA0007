<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.1.251">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>spatial</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="Spatial_files/libs/clipboard/clipboard.min.js"></script>
<script src="Spatial_files/libs/quarto-html/quarto.js"></script>
<script src="Spatial_files/libs/quarto-html/popper.min.js"></script>
<script src="Spatial_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="Spatial_files/libs/quarto-html/anchor.min.js"></script>
<link href="Spatial_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="Spatial_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="Spatial_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="Spatial_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="Spatial_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script>
<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>


</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">



<div class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co">#载入包</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pandas <span class="im">import</span> Series,DataFrame</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib <span class="im">as</span> mpl</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> matplotlib <span class="im">import</span> pyplot <span class="im">as</span> plt</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> matplotlib <span class="im">import</span> colors</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> mpl_toolkits.mplot3d <span class="im">import</span> Axes3D</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.cm</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> math</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> datetime</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> statsmodels</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> statsmodels.api <span class="im">as</span> sm</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> statsmodels.formula.api <span class="im">as</span> smf </span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> statsmodels.stats.outliers_influence <span class="im">import</span> variance_inflation_factor </span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> statsmodels.tools.tools <span class="im">import</span> add_constant</span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> sklearn</span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.linear_model <span class="im">import</span> LogisticRegression</span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.linear_model <span class="im">import</span> LinearRegression</span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> RobustScaler</span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> sklearn.metrics <span class="im">as</span> sklm</span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> confusion_matrix</span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> sklearn.cluster <span class="im">as</span> sklc</span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sn</span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> scipy</span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy.stats <span class="im">import</span> pearsonr</span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> arcpy</span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> geopandas</span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> warnings <span class="im">import</span> simplefilter</span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a>simplefilter(action<span class="op">=</span><span class="st">'ignore'</span>, category<span class="op">=</span><span class="pp">Warning</span>)</span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>matplotlib inline</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="110">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Contributor: Lu Zhao</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="co">#Data cleanning</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="co">'''</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="co">1. 读取原始数据并删除无效行</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="co">2. 处理空值并定义部分文本</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="co">3. 将部分值以判断有无进行呈现(license_tf,host_location_tf)</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="co">4. 将部分值以定量方法进行呈现(host_verification_num,amenities_num)</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="co">5. 计算房东加入Airbnb的时间(host_duration)</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a><span class="co">6. 热门程度指数计算(pop_past,pop_future,popularity)</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a><span class="co">7. 删除无效变量</span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a><span class="co">8. 输出清洗后数据</span></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a><span class="co">'''</span></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a><span class="co">#读取原始数据并删除无效行</span></span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>listings_data <span class="op">=</span> pd.read_csv(<span class="st">'https://raw.githubusercontent.com/XianlaiYin/Data/main/listings.csv'</span>)</span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a><span class="co">#drop columns and select points in Seattle</span></span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>listings_data_1 <span class="op">=</span> listings_data.drop(labels<span class="op">=</span>[<span class="st">'name'</span>,<span class="st">'description'</span>,<span class="st">'neighborhood_overview'</span>,<span class="st">'neighbourhood'</span>,<span class="st">'host_thumbnail_url'</span>,<span class="st">'host_picture_url'</span>,<span class="st">'picture_url'</span>,<span class="st">'calendar_last_scraped'</span>,<span class="st">'host_url'</span>,<span class="st">'host_name'</span>,<span class="st">'host_about'</span>,<span class="st">'scrape_id'</span>, <span class="st">'last_scraped'</span>, <span class="st">'source'</span>, <span class="st">'listing_url'</span>, <span class="st">'host_neighbourhood'</span>, <span class="st">'neighbourhood_cleansed'</span>, <span class="st">'neighbourhood_group_cleansed'</span>, <span class="st">'minimum_nights'</span>, <span class="st">'maximum_nights'</span>, <span class="st">'minimum_minimum_nights'</span>, <span class="st">'maximum_minimum_nights'</span>, <span class="st">'minimum_maximum_nights'</span>, <span class="st">'maximum_maximum_nights'</span>, <span class="st">'calendar_updated'</span>, <span class="st">'availability_60'</span>,<span class="st">'availability_90'</span>, <span class="st">'availability_365'</span>, <span class="st">'number_of_reviews'</span>, <span class="st">'number_of_reviews_ltm'</span>, <span class="st">'number_of_reviews_l30d'</span>, <span class="st">'first_review'</span>, <span class="st">'last_review'</span>,<span class="st">'calculated_host_listings_count_entire_homes'</span>, <span class="st">'calculated_host_listings_count_private_rooms'</span>, <span class="st">'calculated_host_listings_count_shared_rooms'</span>, <span class="st">'host_listings_count'</span>, <span class="st">'host_total_listings_count'</span>], axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>listings_seattle<span class="op">=</span> listings_data_1.drop(listings_data_1[listings_data_1[<span class="st">'has_availability'</span>] <span class="op">==</span> <span class="st">'f'</span>].index)</span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>listings_seattle.reset_index(drop<span class="op">=</span><span class="va">True</span>,inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a><span class="co">#Dealing with null values and defining partial text</span></span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a>listings_seattle[<span class="st">'reviews_per_month'</span>] <span class="op">=</span> listings_seattle[<span class="st">'reviews_per_month'</span>].replace([np.nan],<span class="dv">0</span>)</span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a>listings_seattle[<span class="st">'bathrooms_text'</span>] <span class="op">=</span> listings_seattle[<span class="st">'bathrooms_text'</span>].replace([np.nan],<span class="st">'0'</span>)</span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a>listings_seattle[<span class="st">'bathrooms'</span>] <span class="op">=</span> listings_seattle[<span class="st">'bathrooms_text'</span>].<span class="bu">str</span>.split(<span class="st">'\s+'</span>).<span class="bu">str</span>[<span class="dv">0</span>]</span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a>listings_seattle[<span class="st">'bathrooms'</span>] <span class="op">=</span> listings_seattle[<span class="st">'bathrooms'</span>].replace(<span class="st">'half-bath'</span>,<span class="fl">0.5</span>)</span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a>listings_seattle[<span class="st">'bathrooms'</span>] <span class="op">=</span> listings_seattle[<span class="st">'bathrooms'</span>].replace(<span class="st">'Half-bath'</span>,<span class="fl">0.5</span>)</span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a>listings_seattle[<span class="st">'bathrooms'</span>] <span class="op">=</span> listings_seattle[<span class="st">'bathrooms'</span>].replace(<span class="st">'Shared'</span>,<span class="fl">0.5</span>)</span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a>listings_seattle[<span class="st">'bathrooms'</span>] <span class="op">=</span> listings_seattle[<span class="st">'bathrooms'</span>].replace([np.nan],<span class="dv">0</span>)</span>
<span id="cb2-30"><a href="#cb2-30" aria-hidden="true" tabindex="-1"></a>listings_seattle[<span class="st">'bathrooms'</span>] <span class="op">=</span> listings_seattle[<span class="st">'bathrooms'</span>].astype(<span class="bu">float</span>)</span>
<span id="cb2-31"><a href="#cb2-31" aria-hidden="true" tabindex="-1"></a>listings_seattle[<span class="st">'bedrooms'</span>] <span class="op">=</span> listings_seattle[<span class="st">'bedrooms'</span>].replace([np.nan],<span class="dv">0</span>)</span>
<span id="cb2-32"><a href="#cb2-32" aria-hidden="true" tabindex="-1"></a>listings_seattle[<span class="st">'host_location'</span>] <span class="op">=</span> listings_seattle[<span class="st">'host_location'</span>].replace([np.nan],<span class="st">' '</span>)</span>
<span id="cb2-33"><a href="#cb2-33" aria-hidden="true" tabindex="-1"></a>listings_seattle[<span class="st">'host_response_time'</span>] <span class="op">=</span> listings_seattle[<span class="st">'host_response_time'</span>].replace([np.nan],<span class="st">'No response'</span>)</span>
<span id="cb2-34"><a href="#cb2-34" aria-hidden="true" tabindex="-1"></a>listings_seattle[<span class="st">'host_response_rate'</span>] <span class="op">=</span> listings_seattle[<span class="st">'host_response_rate'</span>].replace([np.nan],<span class="st">'0'</span>)</span>
<span id="cb2-35"><a href="#cb2-35" aria-hidden="true" tabindex="-1"></a>listings_seattle[<span class="st">'host_response_rate'</span>] <span class="op">=</span> listings_seattle[<span class="st">'host_response_rate'</span>].<span class="bu">str</span>.split(<span class="st">'%'</span>).<span class="bu">str</span>[<span class="dv">0</span>]</span>
<span id="cb2-36"><a href="#cb2-36" aria-hidden="true" tabindex="-1"></a>listings_seattle[<span class="st">'host_response_rate'</span>] <span class="op">=</span> listings_seattle[<span class="st">'host_response_rate'</span>].astype(<span class="bu">int</span>)</span>
<span id="cb2-37"><a href="#cb2-37" aria-hidden="true" tabindex="-1"></a>listings_seattle[<span class="st">'host_acceptance_rate'</span>] <span class="op">=</span> listings_seattle[<span class="st">'host_acceptance_rate'</span>].replace([np.nan],<span class="st">'0'</span>)</span>
<span id="cb2-38"><a href="#cb2-38" aria-hidden="true" tabindex="-1"></a>listings_seattle[<span class="st">'host_acceptance_rate'</span>] <span class="op">=</span> listings_seattle[<span class="st">'host_acceptance_rate'</span>].<span class="bu">str</span>.split(<span class="st">'%'</span>).<span class="bu">str</span>[<span class="dv">0</span>]</span>
<span id="cb2-39"><a href="#cb2-39" aria-hidden="true" tabindex="-1"></a>listings_seattle[<span class="st">'host_acceptance_rate'</span>] <span class="op">=</span> listings_seattle[<span class="st">'host_acceptance_rate'</span>].astype(<span class="bu">float</span>)</span>
<span id="cb2-40"><a href="#cb2-40" aria-hidden="true" tabindex="-1"></a>listings_seattle[<span class="st">'price'</span>]<span class="op">=</span>listings_seattle[<span class="st">'price'</span>].<span class="bu">str</span>.replace(<span class="st">'$'</span>,<span class="st">''</span>)</span>
<span id="cb2-41"><a href="#cb2-41" aria-hidden="true" tabindex="-1"></a>listings_seattle[<span class="st">'price'</span>]<span class="op">=</span>listings_seattle[<span class="st">'price'</span>].<span class="bu">str</span>.replace(<span class="st">','</span>,<span class="st">''</span>)</span>
<span id="cb2-42"><a href="#cb2-42" aria-hidden="true" tabindex="-1"></a>listings_seattle[<span class="st">'price'</span>]<span class="op">=</span>listings_seattle[<span class="st">'price'</span>].astype(<span class="bu">float</span>)</span>
<span id="cb2-43"><a href="#cb2-43" aria-hidden="true" tabindex="-1"></a>listings_seattle_1 <span class="op">=</span> listings_seattle.drop(listings_data_1[listings_data_1[<span class="st">'price'</span>] <span class="op">==</span> <span class="dv">0</span>].index)</span>
<span id="cb2-44"><a href="#cb2-44" aria-hidden="true" tabindex="-1"></a>listings_seattle_1.reset_index(drop<span class="op">=</span><span class="va">True</span>,inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb2-45"><a href="#cb2-45" aria-hidden="true" tabindex="-1"></a>listings_seattle_1[<span class="st">'license'</span>] <span class="op">=</span> listings_seattle_1[<span class="st">'license'</span>].<span class="bu">str</span>.contains(<span class="st">'S'</span>,na <span class="op">=</span> <span class="va">False</span>)</span>
<span id="cb2-46"><a href="#cb2-46" aria-hidden="true" tabindex="-1"></a>listings_seattle_1 <span class="op">=</span> listings_seattle_1.dropna(axis<span class="op">=</span><span class="dv">0</span>, how <span class="op">=</span> <span class="st">'any'</span>, subset <span class="op">=</span>[<span class="st">"host_is_superhost"</span>,<span class="st">"minimum_nights_avg_ntm"</span>,<span class="st">"beds"</span>,<span class="st">"review_scores_value"</span>])</span>
<span id="cb2-47"><a href="#cb2-47" aria-hidden="true" tabindex="-1"></a><span class="co">#host_response_time</span></span>
<span id="cb2-48"><a href="#cb2-48" aria-hidden="true" tabindex="-1"></a>response_dic <span class="op">=</span> {<span class="st">"No response"</span>:<span class="dv">1</span>,</span>
<span id="cb2-49"><a href="#cb2-49" aria-hidden="true" tabindex="-1"></a>               <span class="st">"a few days or more"</span>:<span class="dv">2</span>,</span>
<span id="cb2-50"><a href="#cb2-50" aria-hidden="true" tabindex="-1"></a>               <span class="st">"within a day"</span>:<span class="dv">3</span>,</span>
<span id="cb2-51"><a href="#cb2-51" aria-hidden="true" tabindex="-1"></a>               <span class="st">"within a few hours"</span>:<span class="dv">4</span>,</span>
<span id="cb2-52"><a href="#cb2-52" aria-hidden="true" tabindex="-1"></a>               <span class="st">"within an hour"</span>:<span class="dv">5</span>}</span>
<span id="cb2-53"><a href="#cb2-53" aria-hidden="true" tabindex="-1"></a>listings_seattle_1[<span class="st">'response_time_num'</span>] <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb2-54"><a href="#cb2-54" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(listings_seattle_1)):</span>
<span id="cb2-55"><a href="#cb2-55" aria-hidden="true" tabindex="-1"></a>    listings_seattle_1[<span class="st">'response_time_num'</span>].iloc[i] <span class="op">=</span> response_dic[listings_seattle_1[<span class="st">'host_response_time'</span>].iloc[i]]</span>
<span id="cb2-56"><a href="#cb2-56" aria-hidden="true" tabindex="-1"></a><span class="co">#'No response'-1</span></span>
<span id="cb2-57"><a href="#cb2-57" aria-hidden="true" tabindex="-1"></a><span class="co">#'a few days or more'-2</span></span>
<span id="cb2-58"><a href="#cb2-58" aria-hidden="true" tabindex="-1"></a><span class="co">#'within a day'-3</span></span>
<span id="cb2-59"><a href="#cb2-59" aria-hidden="true" tabindex="-1"></a><span class="co">#'within a few hours'-4</span></span>
<span id="cb2-60"><a href="#cb2-60" aria-hidden="true" tabindex="-1"></a><span class="co">#'within an hour' -5</span></span>
<span id="cb2-61"><a href="#cb2-61" aria-hidden="true" tabindex="-1"></a><span class="co">#room_type</span></span>
<span id="cb2-62"><a href="#cb2-62" aria-hidden="true" tabindex="-1"></a>type_dic <span class="op">=</span> {<span class="st">"Shared room"</span>:<span class="dv">1</span>,</span>
<span id="cb2-63"><a href="#cb2-63" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Hotel room'</span>:<span class="dv">2</span>,</span>
<span id="cb2-64"><a href="#cb2-64" aria-hidden="true" tabindex="-1"></a>            <span class="st">"Private room"</span>:<span class="dv">2</span>,</span>
<span id="cb2-65"><a href="#cb2-65" aria-hidden="true" tabindex="-1"></a>            <span class="st">"Entire home/apt"</span>:<span class="dv">3</span>}</span>
<span id="cb2-66"><a href="#cb2-66" aria-hidden="true" tabindex="-1"></a>listings_seattle_1[<span class="st">'type_num'</span>] <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb2-67"><a href="#cb2-67" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(listings_seattle_1)):</span>
<span id="cb2-68"><a href="#cb2-68" aria-hidden="true" tabindex="-1"></a>    listings_seattle_1[<span class="st">'type_num'</span>].iloc[i] <span class="op">=</span> type_dic[listings_seattle_1[<span class="st">'room_type'</span>].iloc[i]]</span>
<span id="cb2-69"><a href="#cb2-69" aria-hidden="true" tabindex="-1"></a><span class="co">#'Shared room'-1</span></span>
<span id="cb2-70"><a href="#cb2-70" aria-hidden="true" tabindex="-1"></a><span class="co">#'Hotel room'-2</span></span>
<span id="cb2-71"><a href="#cb2-71" aria-hidden="true" tabindex="-1"></a><span class="co">#'Private room'-2</span></span>
<span id="cb2-72"><a href="#cb2-72" aria-hidden="true" tabindex="-1"></a><span class="co">#'Entire home/apt'-3</span></span>
<span id="cb2-73"><a href="#cb2-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-74"><a href="#cb2-74" aria-hidden="true" tabindex="-1"></a><span class="co">#license_tf</span></span>
<span id="cb2-75"><a href="#cb2-75" aria-hidden="true" tabindex="-1"></a>listings_seattle_1[<span class="st">'license_tf'</span>] <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb2-76"><a href="#cb2-76" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(listings_seattle_1)):</span>
<span id="cb2-77"><a href="#cb2-77" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> listings_seattle_1[<span class="st">'license'</span>].iloc[i] <span class="op">==</span> <span class="va">False</span>:</span>
<span id="cb2-78"><a href="#cb2-78" aria-hidden="true" tabindex="-1"></a>        listings_seattle_1[<span class="st">'license_tf'</span>].iloc[i]<span class="op">=</span><span class="st">'f'</span></span>
<span id="cb2-79"><a href="#cb2-79" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb2-80"><a href="#cb2-80" aria-hidden="true" tabindex="-1"></a>        listings_seattle_1[<span class="st">'license_tf'</span>].iloc[i]<span class="op">=</span><span class="st">'t'</span></span>
<span id="cb2-81"><a href="#cb2-81" aria-hidden="true" tabindex="-1"></a><span class="co">#host_location_tf</span></span>
<span id="cb2-82"><a href="#cb2-82" aria-hidden="true" tabindex="-1"></a>listings_seattle_1[<span class="st">'host_location_tf'</span>] <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb2-83"><a href="#cb2-83" aria-hidden="true" tabindex="-1"></a>listings_seattle_1[<span class="st">'host_location_tf'</span>] <span class="op">=</span> listings_seattle_1[<span class="st">'host_location'</span>].<span class="bu">str</span>.contains(<span class="st">'Seattle'</span>,na <span class="op">=</span> <span class="va">False</span>)</span>
<span id="cb2-84"><a href="#cb2-84" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(listings_seattle_1)):</span>
<span id="cb2-85"><a href="#cb2-85" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> listings_seattle_1[<span class="st">'host_location_tf'</span>].iloc[i] <span class="op">==</span> <span class="va">False</span>:</span>
<span id="cb2-86"><a href="#cb2-86" aria-hidden="true" tabindex="-1"></a>        listings_seattle_1[<span class="st">'host_location_tf'</span>].iloc[i]<span class="op">=</span><span class="st">'f'</span></span>
<span id="cb2-87"><a href="#cb2-87" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb2-88"><a href="#cb2-88" aria-hidden="true" tabindex="-1"></a>        listings_seattle_1[<span class="st">'host_location_tf'</span>].iloc[i] <span class="op">=</span> <span class="st">'t'</span></span>
<span id="cb2-89"><a href="#cb2-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-90"><a href="#cb2-90" aria-hidden="true" tabindex="-1"></a><span class="co">#host_verfications个数, host_verification_num, int格式</span></span>
<span id="cb2-91"><a href="#cb2-91" aria-hidden="true" tabindex="-1"></a>listings_seattle_1[<span class="st">'host_verifications_num'</span>]<span class="op">=</span><span class="dv">0</span></span>
<span id="cb2-92"><a href="#cb2-92" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(listings_seattle_1)):</span>
<span id="cb2-93"><a href="#cb2-93" aria-hidden="true" tabindex="-1"></a>    listings_seattle_1[<span class="st">'host_verifications_num'</span>].iloc[i] <span class="op">=</span> (listings_seattle_1[<span class="st">'host_verifications'</span>].iloc[i]).count(<span class="st">','</span>)<span class="op">+</span><span class="dv">1</span></span>
<span id="cb2-94"><a href="#cb2-94" aria-hidden="true" tabindex="-1"></a><span class="co">#amenities个数, amenities_num, int格式</span></span>
<span id="cb2-95"><a href="#cb2-95" aria-hidden="true" tabindex="-1"></a>listings_seattle_1[<span class="st">'amenities_num'</span>]<span class="op">=</span><span class="dv">0</span></span>
<span id="cb2-96"><a href="#cb2-96" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(listings_seattle_1)):</span>
<span id="cb2-97"><a href="#cb2-97" aria-hidden="true" tabindex="-1"></a>    listings_seattle_1[<span class="st">'amenities_num'</span>].iloc[i] <span class="op">=</span> (listings_seattle_1[<span class="st">'amenities'</span>].iloc[i]).count(<span class="st">','</span>)<span class="op">+</span><span class="dv">1</span></span>
<span id="cb2-98"><a href="#cb2-98" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-99"><a href="#cb2-99" aria-hidden="true" tabindex="-1"></a><span class="co">#计算房东加入Airbnb的时间(host_duration)</span></span>
<span id="cb2-100"><a href="#cb2-100" aria-hidden="true" tabindex="-1"></a>listings_seattle_1[<span class="st">'present_time'</span>] <span class="op">=</span> datetime.date.today()</span>
<span id="cb2-101"><a href="#cb2-101" aria-hidden="true" tabindex="-1"></a>listings_seattle_1[<span class="st">'start_time'</span>] <span class="op">=</span> <span class="st">''</span></span>
<span id="cb2-102"><a href="#cb2-102" aria-hidden="true" tabindex="-1"></a>listings_seattle_1[<span class="st">'host_duration'</span>] <span class="op">=</span> <span class="st">''</span></span>
<span id="cb2-103"><a href="#cb2-103" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(listings_seattle_1)):</span>
<span id="cb2-104"><a href="#cb2-104" aria-hidden="true" tabindex="-1"></a>    listings_seattle_1[<span class="st">'start_time'</span>].iloc[i] <span class="op">=</span> datetime.datetime.strptime(<span class="bu">str</span>(listings_seattle_1[<span class="st">'host_since'</span>].iloc[i]), <span class="st">'%Y-%m-</span><span class="sc">%d</span><span class="st">'</span>).date()</span>
<span id="cb2-105"><a href="#cb2-105" aria-hidden="true" tabindex="-1"></a>    listings_seattle_1[<span class="st">'host_duration'</span>].iloc[i] <span class="op">=</span> (listings_seattle_1[<span class="st">'present_time'</span>].iloc[i] <span class="op">-</span> listings_seattle_1[<span class="st">'start_time'</span>].iloc[i]).days</span>
<span id="cb2-106"><a href="#cb2-106" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-107"><a href="#cb2-107" aria-hidden="true" tabindex="-1"></a><span class="co">#Calculating the popularity(pop_past,pop_future,popularity)</span></span>
<span id="cb2-108"><a href="#cb2-108" aria-hidden="true" tabindex="-1"></a><span class="co">#booked_30=30-availability_30</span></span>
<span id="cb2-109"><a href="#cb2-109" aria-hidden="true" tabindex="-1"></a>listings_seattle_1[<span class="st">'book_30'</span>]<span class="op">=</span><span class="dv">0</span></span>
<span id="cb2-110"><a href="#cb2-110" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(listings_seattle_1)):</span>
<span id="cb2-111"><a href="#cb2-111" aria-hidden="true" tabindex="-1"></a>    listings_seattle_1[<span class="st">'book_30'</span>].iloc[i] <span class="op">=</span> <span class="dv">30</span><span class="op">-</span>listings_seattle_1[<span class="st">'availability_30'</span>].iloc[i]</span>
<span id="cb2-112"><a href="#cb2-112" aria-hidden="true" tabindex="-1"></a><span class="co">#popularity：The average number of comments per month is normalised to past popularity and the number of scheduled days in the coming month is normalised to expected popularity, and the two are added together to obtain</span></span>
<span id="cb2-113"><a href="#cb2-113" aria-hidden="true" tabindex="-1"></a><span class="co">#standardization,from lecture week6 P83</span></span>
<span id="cb2-114"><a href="#cb2-114" aria-hidden="true" tabindex="-1"></a>reviews_monthly_mean <span class="op">=</span> listings_seattle_1[<span class="st">'reviews_per_month'</span>].mean()</span>
<span id="cb2-115"><a href="#cb2-115" aria-hidden="true" tabindex="-1"></a>reviews_monthly_mean <span class="op">=</span> <span class="bu">round</span> (reviews_monthly_mean,<span class="dv">2</span>)</span>
<span id="cb2-116"><a href="#cb2-116" aria-hidden="true" tabindex="-1"></a>reviews_monthly_std <span class="op">=</span> listings_seattle_1[<span class="st">'reviews_per_month'</span>].std()</span>
<span id="cb2-117"><a href="#cb2-117" aria-hidden="true" tabindex="-1"></a>reviews_monthly_std <span class="op">=</span> <span class="bu">round</span> (reviews_monthly_std,<span class="dv">2</span>)</span>
<span id="cb2-118"><a href="#cb2-118" aria-hidden="true" tabindex="-1"></a>book30_mean <span class="op">=</span> listings_seattle_1[<span class="st">'book_30'</span>].mean()</span>
<span id="cb2-119"><a href="#cb2-119" aria-hidden="true" tabindex="-1"></a>book30_mean <span class="op">=</span> <span class="bu">round</span>(book30_mean,<span class="dv">2</span>)</span>
<span id="cb2-120"><a href="#cb2-120" aria-hidden="true" tabindex="-1"></a>book30_std <span class="op">=</span> listings_seattle_1[<span class="st">'book_30'</span>].std()</span>
<span id="cb2-121"><a href="#cb2-121" aria-hidden="true" tabindex="-1"></a>book30_std <span class="op">=</span> <span class="bu">round</span>(book30_std,<span class="dv">2</span>)</span>
<span id="cb2-122"><a href="#cb2-122" aria-hidden="true" tabindex="-1"></a>listings_seattle_1[<span class="st">'pop_past'</span>] <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb2-123"><a href="#cb2-123" aria-hidden="true" tabindex="-1"></a>listings_seattle_1[<span class="st">'pop_future'</span>] <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb2-124"><a href="#cb2-124" aria-hidden="true" tabindex="-1"></a>listings_seattle_1[<span class="st">'popularity'</span>] <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb2-125"><a href="#cb2-125" aria-hidden="true" tabindex="-1"></a><span class="co">#pop_past</span></span>
<span id="cb2-126"><a href="#cb2-126" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(listings_seattle_1)):</span>
<span id="cb2-127"><a href="#cb2-127" aria-hidden="true" tabindex="-1"></a>    listings_seattle_1[<span class="st">'pop_past'</span>].iloc[i] <span class="op">=</span> (listings_seattle_1[<span class="st">'reviews_per_month'</span>].iloc[i]<span class="op">-</span>reviews_monthly_mean)<span class="op">/</span>reviews_monthly_std</span>
<span id="cb2-128"><a href="#cb2-128" aria-hidden="true" tabindex="-1"></a>    listings_seattle_1[<span class="st">'pop_past'</span>].iloc[i] <span class="op">=</span> <span class="bu">round</span> (listings_seattle_1[<span class="st">'pop_past'</span>].iloc[i],<span class="dv">2</span>)</span>
<span id="cb2-129"><a href="#cb2-129" aria-hidden="true" tabindex="-1"></a><span class="co">#pop_future</span></span>
<span id="cb2-130"><a href="#cb2-130" aria-hidden="true" tabindex="-1"></a>    listings_seattle_1[<span class="st">'pop_future'</span>].iloc[i] <span class="op">=</span> (listings_seattle_1[<span class="st">'book_30'</span>].iloc[i]<span class="op">-</span>book30_mean)<span class="op">/</span>book30_std</span>
<span id="cb2-131"><a href="#cb2-131" aria-hidden="true" tabindex="-1"></a>    listings_seattle_1[<span class="st">'pop_future'</span>].iloc[i] <span class="op">=</span> <span class="bu">round</span> (listings_seattle_1[<span class="st">'pop_future'</span>].iloc[i],<span class="dv">2</span>)</span>
<span id="cb2-132"><a href="#cb2-132" aria-hidden="true" tabindex="-1"></a><span class="co">#popularity</span></span>
<span id="cb2-133"><a href="#cb2-133" aria-hidden="true" tabindex="-1"></a>    listings_seattle_1[<span class="st">'popularity'</span>].iloc[i] <span class="op">=</span> listings_seattle_1[<span class="st">'pop_past'</span>].iloc[i] <span class="op">+</span> listings_seattle_1[<span class="st">'pop_future'</span>].iloc[i] </span>
<span id="cb2-134"><a href="#cb2-134" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-135"><a href="#cb2-135" aria-hidden="true" tabindex="-1"></a><span class="co">#删除无效变量</span></span>
<span id="cb2-136"><a href="#cb2-136" aria-hidden="true" tabindex="-1"></a>listings_seattle_final <span class="op">=</span> listings_seattle_1</span>
<span id="cb2-137"><a href="#cb2-137" aria-hidden="true" tabindex="-1"></a>listings_seattle_clean <span class="op">=</span> listings_seattle_1.drop(labels<span class="op">=</span>[<span class="st">'host_since'</span>,<span class="st">'host_location'</span>,<span class="st">'host_response_time'</span>,<span class="st">'host_verifications'</span>,<span class="st">'bathrooms_text'</span>,<span class="st">'amenities'</span>,<span class="st">'has_availability'</span>,<span class="st">'license'</span>,<span class="st">'present_time'</span>,<span class="st">'start_time'</span>,<span class="st">'property_type'</span>,<span class="st">'room_type'</span>,<span class="st">'availability_30'</span>,<span class="st">'book_30'</span>,<span class="st">'reviews_per_month'</span>], axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb2-138"><a href="#cb2-138" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-139"><a href="#cb2-139" aria-hidden="true" tabindex="-1"></a><span class="co">#输出清洗后数据</span></span>
<span id="cb2-140"><a href="#cb2-140" aria-hidden="true" tabindex="-1"></a>listings_seattle_final.to_csv(<span class="st">'listings_final.csv'</span>,index<span class="op">=</span><span class="va">False</span>,header<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb2-141"><a href="#cb2-141" aria-hidden="true" tabindex="-1"></a>listings_seattle_clean.to_csv(<span class="st">'listings_clean.csv'</span>,index<span class="op">=</span><span class="va">False</span>,header<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="111">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Contributor: Xianlai Yin</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="co">#Spatial Analysis</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="co">#Created by Modelbuilder</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="co">#POI source: Openstreetmap</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="co">'''</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a><span class="co">1. Calculate the number of public transport stops in the vicinity (0.5km)</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a><span class="co">2. Calculate the number of POIs in the vicinity (0.5km)</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a><span class="co">3. Calculate the number of hotels in the vicinity (0.5km)</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a><span class="co">4. Calculate the number of rooms in the vicinity (0.5km) and their average price</span></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a><span class="co">5. Calculate the distance to the nearest attraction</span></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a><span class="co">6. Calculate the distance to the city centre</span></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a><span class="co">'''</span></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> spatial_analysis():</span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>    arcpy.env.overwriteOutput <span class="op">=</span> <span class="va">True</span></span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>    arcpy.ImportToolbox(<span class="vs">r"c:\program files\arcgis\pro\Resources\ArcToolbox\toolboxes\Data Management Tools.tbx"</span>)</span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a>    listings_clean_csv <span class="op">=</span> <span class="st">"D:</span><span class="ch">\\</span><span class="st">UCL_CODE</span><span class="ch">\\</span><span class="st">CASA0007</span><span class="ch">\\</span><span class="st">work</span><span class="ch">\\</span><span class="st">Group</span><span class="ch">\\</span><span class="st">listings_clean.csv"</span></span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a>    poi_shp <span class="op">=</span> <span class="st">"D:</span><span class="ch">\\</span><span class="st">UCL_CODE</span><span class="ch">\\</span><span class="st">Data</span><span class="ch">\\</span><span class="st">POI</span><span class="ch">\\</span><span class="st">poi.shp"</span></span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a>    places_shp <span class="op">=</span> <span class="st">"D:</span><span class="ch">\\</span><span class="st">UCL_CODE</span><span class="ch">\\</span><span class="st">Data</span><span class="ch">\\</span><span class="st">POI</span><span class="ch">\\</span><span class="st">places.shp"</span></span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a>    transport_shp <span class="op">=</span> <span class="st">"D:</span><span class="ch">\\</span><span class="st">UCL_CODE</span><span class="ch">\\</span><span class="st">Data</span><span class="ch">\\</span><span class="st">POI</span><span class="ch">\\</span><span class="st">transport.shp"</span></span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a>    Group <span class="op">=</span> <span class="st">"D:</span><span class="ch">\\</span><span class="st">UCL_CODE</span><span class="ch">\\</span><span class="st">CASA0007</span><span class="ch">\\</span><span class="st">work</span><span class="ch">\\</span><span class="st">Group"</span></span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Process: XY Table To Point (XY Table To Point) (management)</span></span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a>    airbnb <span class="op">=</span> <span class="st">"C:</span><span class="ch">\\</span><span class="st">Users</span><span class="ch">\\</span><span class="st">xianl</span><span class="ch">\\</span><span class="st">Documents</span><span class="ch">\\</span><span class="st">ArcGIS</span><span class="ch">\\</span><span class="st">Projects</span><span class="ch">\\</span><span class="st">CASA0007Group</span><span class="ch">\\</span><span class="st">CASA0007Group.gdb</span><span class="ch">\\</span><span class="st">airbnb"</span></span>
<span id="cb3-29"><a href="#cb3-29" aria-hidden="true" tabindex="-1"></a>    arcpy.management.XYTableToPoint(in_table<span class="op">=</span>listings_clean_csv, out_feature_class<span class="op">=</span>airbnb, x_field<span class="op">=</span><span class="st">"longitude"</span>, y_field<span class="op">=</span><span class="st">"latitude"</span>, z_field<span class="op">=</span><span class="st">""</span>,</span>
<span id="cb3-30"><a href="#cb3-30" aria-hidden="true" tabindex="-1"></a>                                    coordinate_system<span class="op">=</span><span class="st">"GEOGCS[</span><span class="ch">\"</span><span class="st">GCS_WGS_1984</span><span class="ch">\"</span><span class="st">,DATUM[</span><span class="ch">\"</span><span class="st">D_WGS_1984</span><span class="ch">\"</span><span class="st">,SPHEROID[</span><span class="ch">\"</span><span class="st">WGS_1984</span><span class="ch">\"</span><span class="st">,6378137.0,298.257223563]],PRIMEM[</span><span class="ch">\"</span><span class="st">Greenwich</span><span class="ch">\"</span><span class="st">,0.0],UNIT[</span><span class="ch">\"</span><span class="st">Degree</span><span class="ch">\"</span><span class="st">,0.0174532925199433]];-400 -400 1000000000;-100000 10000;-100000 10000;8.98315284119521E-09;0.001;0.001;IsHighPrecision"</span>)</span>
<span id="cb3-31"><a href="#cb3-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-32"><a href="#cb3-32" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Process: Select (Select) (analysis)</span></span>
<span id="cb3-33"><a href="#cb3-33" aria-hidden="true" tabindex="-1"></a>    poi_attractions <span class="op">=</span> <span class="st">"C:</span><span class="ch">\\</span><span class="st">Users</span><span class="ch">\\</span><span class="st">xianl</span><span class="ch">\\</span><span class="st">Documents</span><span class="ch">\\</span><span class="st">ArcGIS</span><span class="ch">\\</span><span class="st">Projects</span><span class="ch">\\</span><span class="st">CASA0007Group</span><span class="ch">\\</span><span class="st">CASA0007Group.gdb</span><span class="ch">\\</span><span class="st">poi_attractions"</span></span>
<span id="cb3-34"><a href="#cb3-34" aria-hidden="true" tabindex="-1"></a>    arcpy.analysis.Select(</span>
<span id="cb3-35"><a href="#cb3-35" aria-hidden="true" tabindex="-1"></a>        in_features<span class="op">=</span>poi_shp, out_feature_class<span class="op">=</span>poi_attractions, where_clause<span class="op">=</span><span class="st">"code = 2721"</span>)</span>
<span id="cb3-36"><a href="#cb3-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-37"><a href="#cb3-37" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Process: Near (Near) (analysis)</span></span>
<span id="cb3-38"><a href="#cb3-38" aria-hidden="true" tabindex="-1"></a>    airbnb_4_ <span class="op">=</span> arcpy.analysis.Near(in_features<span class="op">=</span>airbnb, near_features<span class="op">=</span>[</span>
<span id="cb3-39"><a href="#cb3-39" aria-hidden="true" tabindex="-1"></a>                                    poi_attractions], search_radius<span class="op">=</span><span class="st">""</span>, location<span class="op">=</span><span class="st">"NO_LOCATION"</span>, angle<span class="op">=</span><span class="st">"NO_ANGLE"</span>, method<span class="op">=</span><span class="st">"GEODESIC"</span>, field_names<span class="op">=</span>[[<span class="st">"NEAR_DIST"</span>, <span class="st">"dist_attractions"</span>]])[<span class="dv">0</span>]</span>
<span id="cb3-40"><a href="#cb3-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-41"><a href="#cb3-41" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Process: Select (Select) (analysis)</span></span>
<span id="cb3-42"><a href="#cb3-42" aria-hidden="true" tabindex="-1"></a>    Seattle <span class="op">=</span> <span class="st">"C:</span><span class="ch">\\</span><span class="st">Users</span><span class="ch">\\</span><span class="st">xianl</span><span class="ch">\\</span><span class="st">Documents</span><span class="ch">\\</span><span class="st">ArcGIS</span><span class="ch">\\</span><span class="st">Projects</span><span class="ch">\\</span><span class="st">CASA0007Group</span><span class="ch">\\</span><span class="st">CASA0007Group.gdb</span><span class="ch">\\</span><span class="st">Seattle"</span></span>
<span id="cb3-43"><a href="#cb3-43" aria-hidden="true" tabindex="-1"></a>    arcpy.analysis.Select(in_features<span class="op">=</span>places_shp, out_feature_class<span class="op">=</span>Seattle,</span>
<span id="cb3-44"><a href="#cb3-44" aria-hidden="true" tabindex="-1"></a>                          where_clause<span class="op">=</span><span class="st">"fclass = 'city' And name = 'Seattle'"</span>)</span>
<span id="cb3-45"><a href="#cb3-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-46"><a href="#cb3-46" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Process: Near (Near) (analysis)</span></span>
<span id="cb3-47"><a href="#cb3-47" aria-hidden="true" tabindex="-1"></a>    airbnb_9_ <span class="op">=</span> arcpy.analysis.Near(in_features<span class="op">=</span>airbnb_4_, near_features<span class="op">=</span>[</span>
<span id="cb3-48"><a href="#cb3-48" aria-hidden="true" tabindex="-1"></a>                                    Seattle], search_radius<span class="op">=</span><span class="st">""</span>, location<span class="op">=</span><span class="st">"NO_LOCATION"</span>, angle<span class="op">=</span><span class="st">"NO_ANGLE"</span>, method<span class="op">=</span><span class="st">"GEODESIC"</span>, field_names<span class="op">=</span>[[<span class="st">"NEAR_DIST"</span>, <span class="st">"dist_city"</span>]])[<span class="dv">0</span>]</span>
<span id="cb3-49"><a href="#cb3-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-50"><a href="#cb3-50" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Process: Buffer (Buffer) (analysis)</span></span>
<span id="cb3-51"><a href="#cb3-51" aria-hidden="true" tabindex="-1"></a>    airbnb_Buffer <span class="op">=</span> <span class="st">"C:</span><span class="ch">\\</span><span class="st">Users</span><span class="ch">\\</span><span class="st">xianl</span><span class="ch">\\</span><span class="st">Documents</span><span class="ch">\\</span><span class="st">ArcGIS</span><span class="ch">\\</span><span class="st">Projects</span><span class="ch">\\</span><span class="st">CASA0007Group</span><span class="ch">\\</span><span class="st">CASA0007Group.gdb</span><span class="ch">\\</span><span class="st">airbnb_Buffer"</span></span>
<span id="cb3-52"><a href="#cb3-52" aria-hidden="true" tabindex="-1"></a>    arcpy.analysis.Buffer(in_features<span class="op">=</span>airbnb, out_feature_class<span class="op">=</span>airbnb_Buffer, buffer_distance_or_field<span class="op">=</span><span class="st">"0.5 Kilometers"</span>,</span>
<span id="cb3-53"><a href="#cb3-53" aria-hidden="true" tabindex="-1"></a>                          line_side<span class="op">=</span><span class="st">"FULL"</span>, line_end_type<span class="op">=</span><span class="st">"ROUND"</span>, dissolve_option<span class="op">=</span><span class="st">"NONE"</span>, dissolve_field<span class="op">=</span>[], method<span class="op">=</span><span class="st">"PLANAR"</span>)</span>
<span id="cb3-54"><a href="#cb3-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-55"><a href="#cb3-55" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Process: Spatial Join (Spatial Join) (analysis)</span></span>
<span id="cb3-56"><a href="#cb3-56" aria-hidden="true" tabindex="-1"></a>    airbnb_count_and_price <span class="op">=</span> <span class="st">"C:</span><span class="ch">\\</span><span class="st">Users</span><span class="ch">\\</span><span class="st">xianl</span><span class="ch">\\</span><span class="st">Documents</span><span class="ch">\\</span><span class="st">ArcGIS</span><span class="ch">\\</span><span class="st">Projects</span><span class="ch">\\</span><span class="st">CASA0007Group</span><span class="ch">\\</span><span class="st">CASA0007Group.gdb</span><span class="ch">\\</span><span class="st">airbnb_count_and_price"</span></span>
<span id="cb3-57"><a href="#cb3-57" aria-hidden="true" tabindex="-1"></a>    arcpy.analysis.SpatialJoin(target_features<span class="op">=</span>airbnb_Buffer, join_features<span class="op">=</span>airbnb, out_feature_class<span class="op">=</span>airbnb_count_and_price, join_operation<span class="op">=</span><span class="st">"JOIN_ONE_TO_ONE"</span>, join_type<span class="op">=</span><span class="st">"KEEP_ALL"</span>,</span>
<span id="cb3-58"><a href="#cb3-58" aria-hidden="true" tabindex="-1"></a>                               field_mapping<span class="op">=</span><span class="st">"price </span><span class="ch">\"</span><span class="st">price</span><span class="ch">\"</span><span class="st"> true true false 8 Double 0 0,Mean,#,C:</span><span class="ch">\\</span><span class="st">Users</span><span class="ch">\\</span><span class="st">xianl</span><span class="ch">\\</span><span class="st">Documents</span><span class="ch">\\</span><span class="st">ArcGIS</span><span class="ch">\\</span><span class="st">Projects</span><span class="ch">\\</span><span class="st">CASA0007Group</span><span class="ch">\\</span><span class="st">CASA0007Group.gdb</span><span class="ch">\\</span><span class="st">airbnb,price,-1,-1"</span>, match_option<span class="op">=</span><span class="st">"INTERSECT"</span>, search_radius<span class="op">=</span><span class="st">""</span>, distance_field_name<span class="op">=</span><span class="st">""</span>)</span>
<span id="cb3-59"><a href="#cb3-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-60"><a href="#cb3-60" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Process: Join Field (Join Field) (management)</span></span>
<span id="cb3-61"><a href="#cb3-61" aria-hidden="true" tabindex="-1"></a>    airbnb_2_ <span class="op">=</span> arcpy.management.JoinField(in_data<span class="op">=</span>airbnb_9_, in_field<span class="op">=</span><span class="st">"OBJECTID"</span>, join_table<span class="op">=</span>airbnb_count_and_price, join_field<span class="op">=</span><span class="st">"OBJECTID"</span>, fields<span class="op">=</span>[</span>
<span id="cb3-62"><a href="#cb3-62" aria-hidden="true" tabindex="-1"></a>    ], fm_option<span class="op">=</span><span class="st">"USE_FM"</span>, field_mapping<span class="op">=</span><span class="st">"airbnb_count </span><span class="ch">\"</span><span class="st">airbnb_count</span><span class="ch">\"</span><span class="st"> true true false 4 Long 0 0,First,#,C:</span><span class="ch">\\</span><span class="st">Users</span><span class="ch">\\</span><span class="st">xianl</span><span class="ch">\\</span><span class="st">Documents</span><span class="ch">\\</span><span class="st">ArcGIS</span><span class="ch">\\</span><span class="st">Projects</span><span class="ch">\\</span><span class="st">CASA0007Group</span><span class="ch">\\</span><span class="st">CASA0007Group.gdb</span><span class="ch">\\</span><span class="st">airbnb_count_and_price,Join_Count,-1,-1;average_price </span><span class="ch">\"</span><span class="st">average_price</span><span class="ch">\"</span><span class="st"> true true false 8 Double 0 0,First,#,C:</span><span class="ch">\\</span><span class="st">Users</span><span class="ch">\\</span><span class="st">xianl</span><span class="ch">\\</span><span class="st">Documents</span><span class="ch">\\</span><span class="st">ArcGIS</span><span class="ch">\\</span><span class="st">Projects</span><span class="ch">\\</span><span class="st">CASA0007Group</span><span class="ch">\\</span><span class="st">CASA0007Group.gdb</span><span class="ch">\\</span><span class="st">airbnb_count_and_price,price,-1,-1"</span>)[<span class="dv">0</span>]</span>
<span id="cb3-63"><a href="#cb3-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-64"><a href="#cb3-64" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Process: Spatial Join (Spatial Join) (analysis)</span></span>
<span id="cb3-65"><a href="#cb3-65" aria-hidden="true" tabindex="-1"></a>    poi_count <span class="op">=</span> <span class="st">"C:</span><span class="ch">\\</span><span class="st">Users</span><span class="ch">\\</span><span class="st">xianl</span><span class="ch">\\</span><span class="st">Documents</span><span class="ch">\\</span><span class="st">ArcGIS</span><span class="ch">\\</span><span class="st">Projects</span><span class="ch">\\</span><span class="st">CASA0007Group</span><span class="ch">\\</span><span class="st">CASA0007Group.gdb</span><span class="ch">\\</span><span class="st">poi_count"</span></span>
<span id="cb3-66"><a href="#cb3-66" aria-hidden="true" tabindex="-1"></a>    arcpy.analysis.SpatialJoin(target_features<span class="op">=</span>airbnb_Buffer, join_features<span class="op">=</span>poi_shp, out_feature_class<span class="op">=</span>poi_count, join_operation<span class="op">=</span><span class="st">"JOIN_ONE_TO_ONE"</span>,</span>
<span id="cb3-67"><a href="#cb3-67" aria-hidden="true" tabindex="-1"></a>                               join_type<span class="op">=</span><span class="st">"KEEP_ALL"</span>, field_mapping<span class="op">=</span><span class="st">""</span>, match_option<span class="op">=</span><span class="st">"INTERSECT"</span>, search_radius<span class="op">=</span><span class="st">""</span>, distance_field_name<span class="op">=</span><span class="st">""</span>)</span>
<span id="cb3-68"><a href="#cb3-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-69"><a href="#cb3-69" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Process: Join Field (Join Field) (management)</span></span>
<span id="cb3-70"><a href="#cb3-70" aria-hidden="true" tabindex="-1"></a>    airbnb_7_ <span class="op">=</span> arcpy.management.JoinField(in_data<span class="op">=</span>airbnb_2_, in_field<span class="op">=</span><span class="st">"OBJECTID"</span>, join_table<span class="op">=</span>poi_count, join_field<span class="op">=</span><span class="st">"OBJECTID"</span>, fields<span class="op">=</span>[</span>
<span id="cb3-71"><a href="#cb3-71" aria-hidden="true" tabindex="-1"></a>    ], fm_option<span class="op">=</span><span class="st">"USE_FM"</span>, field_mapping<span class="op">=</span><span class="st">"poi_count </span><span class="ch">\"</span><span class="st">poi_count</span><span class="ch">\"</span><span class="st"> true true false 4 Long 0 0,First,#,C:</span><span class="ch">\\</span><span class="st">Users</span><span class="ch">\\</span><span class="st">xianl</span><span class="ch">\\</span><span class="st">Documents</span><span class="ch">\\</span><span class="st">ArcGIS</span><span class="ch">\\</span><span class="st">Projects</span><span class="ch">\\</span><span class="st">CASA0007Group</span><span class="ch">\\</span><span class="st">CASA0007Group.gdb</span><span class="ch">\\</span><span class="st">poi_count,Join_Count,-1,-1"</span>)[<span class="dv">0</span>]</span>
<span id="cb3-72"><a href="#cb3-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-73"><a href="#cb3-73" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Process: Spatial Join (Spatial Join) (analysis)</span></span>
<span id="cb3-74"><a href="#cb3-74" aria-hidden="true" tabindex="-1"></a>    transport_count <span class="op">=</span> <span class="st">"C:</span><span class="ch">\\</span><span class="st">Users</span><span class="ch">\\</span><span class="st">xianl</span><span class="ch">\\</span><span class="st">Documents</span><span class="ch">\\</span><span class="st">ArcGIS</span><span class="ch">\\</span><span class="st">Projects</span><span class="ch">\\</span><span class="st">CASA0007Group</span><span class="ch">\\</span><span class="st">CASA0007Group.gdb</span><span class="ch">\\</span><span class="st">transport_count"</span></span>
<span id="cb3-75"><a href="#cb3-75" aria-hidden="true" tabindex="-1"></a>    arcpy.analysis.SpatialJoin(target_features<span class="op">=</span>airbnb_Buffer, join_features<span class="op">=</span>transport_shp, out_feature_class<span class="op">=</span>transport_count,</span>
<span id="cb3-76"><a href="#cb3-76" aria-hidden="true" tabindex="-1"></a>                               join_operation<span class="op">=</span><span class="st">"JOIN_ONE_TO_ONE"</span>, join_type<span class="op">=</span><span class="st">"KEEP_ALL"</span>, field_mapping<span class="op">=</span><span class="st">""</span>, match_option<span class="op">=</span><span class="st">"INTERSECT"</span>, search_radius<span class="op">=</span><span class="st">""</span>, distance_field_name<span class="op">=</span><span class="st">""</span>)</span>
<span id="cb3-77"><a href="#cb3-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-78"><a href="#cb3-78" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Process: Join Field (Join Field) (management)</span></span>
<span id="cb3-79"><a href="#cb3-79" aria-hidden="true" tabindex="-1"></a>    airbnb_6_ <span class="op">=</span> arcpy.management.JoinField(in_data<span class="op">=</span>airbnb_7_, in_field<span class="op">=</span><span class="st">"OBJECTID"</span>, join_table<span class="op">=</span>transport_count, join_field<span class="op">=</span><span class="st">"OBJECTID"</span>, fields<span class="op">=</span>[</span>
<span id="cb3-80"><a href="#cb3-80" aria-hidden="true" tabindex="-1"></a>    ], fm_option<span class="op">=</span><span class="st">"USE_FM"</span>, field_mapping<span class="op">=</span><span class="st">"transport_count </span><span class="ch">\"</span><span class="st">transport_count</span><span class="ch">\"</span><span class="st"> true true false 4 Long 0 0,First,#,C:</span><span class="ch">\\</span><span class="st">Users</span><span class="ch">\\</span><span class="st">xianl</span><span class="ch">\\</span><span class="st">Documents</span><span class="ch">\\</span><span class="st">ArcGIS</span><span class="ch">\\</span><span class="st">Projects</span><span class="ch">\\</span><span class="st">CASA0007Group</span><span class="ch">\\</span><span class="st">CASA0007Group.gdb</span><span class="ch">\\</span><span class="st">transport_count,Join_Count,-1,-1"</span>)[<span class="dv">0</span>]</span>
<span id="cb3-81"><a href="#cb3-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-82"><a href="#cb3-82" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Process: Select (Select) (analysis)</span></span>
<span id="cb3-83"><a href="#cb3-83" aria-hidden="true" tabindex="-1"></a>    poi_hotel <span class="op">=</span> <span class="st">"C:</span><span class="ch">\\</span><span class="st">Users</span><span class="ch">\\</span><span class="st">xianl</span><span class="ch">\\</span><span class="st">Documents</span><span class="ch">\\</span><span class="st">ArcGIS</span><span class="ch">\\</span><span class="st">Projects</span><span class="ch">\\</span><span class="st">CASA0007Group</span><span class="ch">\\</span><span class="st">CASA0007Group.gdb</span><span class="ch">\\</span><span class="st">poi_hotel"</span></span>
<span id="cb3-84"><a href="#cb3-84" aria-hidden="true" tabindex="-1"></a>    arcpy.analysis.Select(in_features<span class="op">=</span>poi_shp, out_feature_class<span class="op">=</span>poi_hotel,</span>
<span id="cb3-85"><a href="#cb3-85" aria-hidden="true" tabindex="-1"></a>                          where_clause<span class="op">=</span><span class="st">"code &gt; 2400 And code &lt; 2420"</span>)</span>
<span id="cb3-86"><a href="#cb3-86" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-87"><a href="#cb3-87" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Process: Spatial Join (Spatial Join) (analysis)</span></span>
<span id="cb3-88"><a href="#cb3-88" aria-hidden="true" tabindex="-1"></a>    hotel_count <span class="op">=</span> <span class="st">"C:</span><span class="ch">\\</span><span class="st">Users</span><span class="ch">\\</span><span class="st">xianl</span><span class="ch">\\</span><span class="st">Documents</span><span class="ch">\\</span><span class="st">ArcGIS</span><span class="ch">\\</span><span class="st">Projects</span><span class="ch">\\</span><span class="st">CASA0007Group</span><span class="ch">\\</span><span class="st">CASA0007Group.gdb</span><span class="ch">\\</span><span class="st">hotel_count"</span></span>
<span id="cb3-89"><a href="#cb3-89" aria-hidden="true" tabindex="-1"></a>    arcpy.analysis.SpatialJoin(target_features<span class="op">=</span>airbnb_Buffer, join_features<span class="op">=</span>poi_hotel, out_feature_class<span class="op">=</span>hotel_count, join_operation<span class="op">=</span><span class="st">"JOIN_ONE_TO_ONE"</span>,</span>
<span id="cb3-90"><a href="#cb3-90" aria-hidden="true" tabindex="-1"></a>                               join_type<span class="op">=</span><span class="st">"KEEP_ALL"</span>, field_mapping<span class="op">=</span><span class="st">""</span>, match_option<span class="op">=</span><span class="st">"INTERSECT"</span>, search_radius<span class="op">=</span><span class="st">""</span>, distance_field_name<span class="op">=</span><span class="st">""</span>)</span>
<span id="cb3-91"><a href="#cb3-91" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-92"><a href="#cb3-92" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Process: Join Field (Join Field) (management)</span></span>
<span id="cb3-93"><a href="#cb3-93" aria-hidden="true" tabindex="-1"></a>    airbnb_5_ <span class="op">=</span> arcpy.management.JoinField(in_data<span class="op">=</span>airbnb_6_, in_field<span class="op">=</span><span class="st">"OBJECTID"</span>, join_table<span class="op">=</span>hotel_count, join_field<span class="op">=</span><span class="st">"OBJECTID"</span>, fields<span class="op">=</span>[</span>
<span id="cb3-94"><a href="#cb3-94" aria-hidden="true" tabindex="-1"></a>    ], fm_option<span class="op">=</span><span class="st">"USE_FM"</span>, field_mapping<span class="op">=</span><span class="st">"hotel_count </span><span class="ch">\"</span><span class="st">hotel_count</span><span class="ch">\"</span><span class="st"> true true false 4 Long 0 0,First,#,C:</span><span class="ch">\\</span><span class="st">Users</span><span class="ch">\\</span><span class="st">xianl</span><span class="ch">\\</span><span class="st">Documents</span><span class="ch">\\</span><span class="st">ArcGIS</span><span class="ch">\\</span><span class="st">Projects</span><span class="ch">\\</span><span class="st">CASA0007Group</span><span class="ch">\\</span><span class="st">CASA0007Group.gdb</span><span class="ch">\\</span><span class="st">hotel_count,Join_Count,-1,-1"</span>)[<span class="dv">0</span>]</span>
<span id="cb3-95"><a href="#cb3-95" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-96"><a href="#cb3-96" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Process: Delete Field (Delete Field) (management)</span></span>
<span id="cb3-97"><a href="#cb3-97" aria-hidden="true" tabindex="-1"></a>    airbnb_8_ <span class="op">=</span> arcpy.management.DeleteField(in_table<span class="op">=</span>airbnb_5_, drop_field<span class="op">=</span>[</span>
<span id="cb3-98"><a href="#cb3-98" aria-hidden="true" tabindex="-1"></a>                                             <span class="st">"NEAR_FID"</span>], method<span class="op">=</span><span class="st">"DELETE_FIELDS"</span>)[<span class="dv">0</span>]</span>
<span id="cb3-99"><a href="#cb3-99" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-100"><a href="#cb3-100" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Process: Table To Table (Table To Table) (conversion)</span></span>
<span id="cb3-101"><a href="#cb3-101" aria-hidden="true" tabindex="-1"></a>    spatial_analysis_csv <span class="op">=</span> arcpy.conversion.TableToTable(in_rows<span class="op">=</span>airbnb_8_, out_path<span class="op">=</span>Group, out_name<span class="op">=</span><span class="st">"spatial_analysis.csv"</span>, where_clause<span class="op">=</span><span class="st">""</span>,</span>
<span id="cb3-102"><a href="#cb3-102" aria-hidden="true" tabindex="-1"></a>                                                         field_mapping<span class="op">=</span><span class="st">"id </span><span class="ch">\"</span><span class="st">id</span><span class="ch">\"</span><span class="st"> true true false 8 Double 0 0,First,#,C:</span><span class="ch">\\</span><span class="st">Users</span><span class="ch">\\</span><span class="st">xianl</span><span class="ch">\\</span><span class="st">Documents</span><span class="ch">\\</span><span class="st">ArcGIS</span><span class="ch">\\</span><span class="st">Projects</span><span class="ch">\\</span><span class="st">CASA0007Group</span><span class="ch">\\</span><span class="st">CASA0007Group.gdb</span><span class="ch">\\</span><span class="st">airbnb,id,-1,-1;host_id </span><span class="ch">\"</span><span class="st">host_id</span><span class="ch">\"</span><span class="st"> true true false 4 Long 0 0,First,#,C:</span><span class="ch">\\</span><span class="st">Users</span><span class="ch">\\</span><span class="st">xianl</span><span class="ch">\\</span><span class="st">Documents</span><span class="ch">\\</span><span class="st">ArcGIS</span><span class="ch">\\</span><span class="st">Projects</span><span class="ch">\\</span><span class="st">CASA0007Group</span><span class="ch">\\</span><span class="st">CASA0007Group.gdb</span><span class="ch">\\</span><span class="st">airbnb,host_id,-1,-1;host_response_rate </span><span class="ch">\"</span><span class="st">host_response_rate</span><span class="ch">\"</span><span class="st"> true true false 4 Long 0 0,First,#,C:</span><span class="ch">\\</span><span class="st">Users</span><span class="ch">\\</span><span class="st">xianl</span><span class="ch">\\</span><span class="st">Documents</span><span class="ch">\\</span><span class="st">ArcGIS</span><span class="ch">\\</span><span class="st">Projects</span><span class="ch">\\</span><span class="st">CASA0007Group</span><span class="ch">\\</span><span class="st">CASA0007Group.gdb</span><span class="ch">\\</span><span class="st">airbnb,host_response_rate,-1,-1;host_acceptance_rate </span><span class="ch">\"</span><span class="st">host_acceptance_rate</span><span class="ch">\"</span><span class="st"> true true false 8 Double 0 0,First,#,C:</span><span class="ch">\\</span><span class="st">Users</span><span class="ch">\\</span><span class="st">xianl</span><span class="ch">\\</span><span class="st">Documents</span><span class="ch">\\</span><span class="st">ArcGIS</span><span class="ch">\\</span><span class="st">Projects</span><span class="ch">\\</span><span class="st">CASA0007Group</span><span class="ch">\\</span><span class="st">CASA0007Group.gdb</span><span class="ch">\\</span><span class="st">airbnb,host_acceptance_rate,-1,-1;host_is_superhost </span><span class="ch">\"</span><span class="st">host_is_superhost</span><span class="ch">\"</span><span class="st"> true true false 8000 Text 0 0,First,#,C:</span><span class="ch">\\</span><span class="st">Users</span><span class="ch">\\</span><span class="st">xianl</span><span class="ch">\\</span><span class="st">Documents</span><span class="ch">\\</span><span class="st">ArcGIS</span><span class="ch">\\</span><span class="st">Projects</span><span class="ch">\\</span><span class="st">CASA0007Group</span><span class="ch">\\</span><span class="st">CASA0007Group.gdb</span><span class="ch">\\</span><span class="st">airbnb,host_is_superhost,0,8000;host_has_profile_pic </span><span class="ch">\"</span><span class="st">host_has_profile_pic</span><span class="ch">\"</span><span class="st"> true true false 8000 Text 0 0,First,#,C:</span><span class="ch">\\</span><span class="st">Users</span><span class="ch">\\</span><span class="st">xianl</span><span class="ch">\\</span><span class="st">Documents</span><span class="ch">\\</span><span class="st">ArcGIS</span><span class="ch">\\</span><span class="st">Projects</span><span class="ch">\\</span><span class="st">CASA0007Group</span><span class="ch">\\</span><span class="st">CASA0007Group.gdb</span><span class="ch">\\</span><span class="st">airbnb,host_has_profile_pic,0,8000;host_identity_verified </span><span class="ch">\"</span><span class="st">host_identity_verified</span><span class="ch">\"</span><span class="st"> true true false 8000 Text 0 0,First,#,C:</span><span class="ch">\\</span><span class="st">Users</span><span class="ch">\\</span><span class="st">xianl</span><span class="ch">\\</span><span class="st">Documents</span><span class="ch">\\</span><span class="st">ArcGIS</span><span class="ch">\\</span><span class="st">Projects</span><span class="ch">\\</span><span class="st">CASA0007Group</span><span class="ch">\\</span><span class="st">CASA0007Group.gdb</span><span class="ch">\\</span><span class="st">airbnb,host_identity_verified,0,8000;latitude </span><span class="ch">\"</span><span class="st">latitude</span><span class="ch">\"</span><span class="st"> true true false 8 Double 0 0,First,#,C:</span><span class="ch">\\</span><span class="st">Users</span><span class="ch">\\</span><span class="st">xianl</span><span class="ch">\\</span><span class="st">Documents</span><span class="ch">\\</span><span class="st">ArcGIS</span><span class="ch">\\</span><span class="st">Projects</span><span class="ch">\\</span><span class="st">CASA0007Group</span><span class="ch">\\</span><span class="st">CASA0007Group.gdb</span><span class="ch">\\</span><span class="st">airbnb,latitude,-1,-1;longitude </span><span class="ch">\"</span><span class="st">longitude</span><span class="ch">\"</span><span class="st"> true true false 8 Double 0 0,First,#,C:</span><span class="ch">\\</span><span class="st">Users</span><span class="ch">\\</span><span class="st">xianl</span><span class="ch">\\</span><span class="st">Documents</span><span class="ch">\\</span><span class="st">ArcGIS</span><span class="ch">\\</span><span class="st">Projects</span><span class="ch">\\</span><span class="st">CASA0007Group</span><span class="ch">\\</span><span class="st">CASA0007Group.gdb</span><span class="ch">\\</span><span class="st">airbnb,longitude,-1,-1;accommodates </span><span class="ch">\"</span><span class="st">accommodates</span><span class="ch">\"</span><span class="st"> true true false 4 Long 0 0,First,#,C:</span><span class="ch">\\</span><span class="st">Users</span><span class="ch">\\</span><span class="st">xianl</span><span class="ch">\\</span><span class="st">Documents</span><span class="ch">\\</span><span class="st">ArcGIS</span><span class="ch">\\</span><span class="st">Projects</span><span class="ch">\\</span><span class="st">CASA0007Group</span><span class="ch">\\</span><span class="st">CASA0007Group.gdb</span><span class="ch">\\</span><span class="st">airbnb,accommodates,-1,-1;bathrooms </span><span class="ch">\"</span><span class="st">bathrooms</span><span class="ch">\"</span><span class="st"> true true false 8 Double 0 0,First,#,C:</span><span class="ch">\\</span><span class="st">Users</span><span class="ch">\\</span><span class="st">xianl</span><span class="ch">\\</span><span class="st">Documents</span><span class="ch">\\</span><span class="st">ArcGIS</span><span class="ch">\\</span><span class="st">Projects</span><span class="ch">\\</span><span class="st">CASA0007Group</span><span class="ch">\\</span><span class="st">CASA0007Group.gdb</span><span class="ch">\\</span><span class="st">airbnb,bathrooms,-1,-1;bedrooms </span><span class="ch">\"</span><span class="st">bedrooms</span><span class="ch">\"</span><span class="st"> true true false 8 Double 0 0,First,#,C:</span><span class="ch">\\</span><span class="st">Users</span><span class="ch">\\</span><span class="st">xianl</span><span class="ch">\\</span><span class="st">Documents</span><span class="ch">\\</span><span class="st">ArcGIS</span><span class="ch">\\</span><span class="st">Projects</span><span class="ch">\\</span><span class="st">CASA0007Group</span><span class="ch">\\</span><span class="st">CASA0007Group.gdb</span><span class="ch">\\</span><span class="st">airbnb,bedrooms,-1,-1;beds </span><span class="ch">\"</span><span class="st">beds</span><span class="ch">\"</span><span class="st"> true true false 8 Double 0 0,First,#,C:</span><span class="ch">\\</span><span class="st">Users</span><span class="ch">\\</span><span class="st">xianl</span><span class="ch">\\</span><span class="st">Documents</span><span class="ch">\\</span><span class="st">ArcGIS</span><span class="ch">\\</span><span class="st">Projects</span><span class="ch">\\</span><span class="st">CASA0007Group</span><span class="ch">\\</span><span class="st">CASA0007Group.gdb</span><span class="ch">\\</span><span class="st">airbnb,beds,-1,-1;price </span><span class="ch">\"</span><span class="st">price</span><span class="ch">\"</span><span class="st"> true true false 8 Double 0 0,First,#,C:</span><span class="ch">\\</span><span class="st">Users</span><span class="ch">\\</span><span class="st">xianl</span><span class="ch">\\</span><span class="st">Documents</span><span class="ch">\\</span><span class="st">ArcGIS</span><span class="ch">\\</span><span class="st">Projects</span><span class="ch">\\</span><span class="st">CASA0007Group</span><span class="ch">\\</span><span class="st">CASA0007Group.gdb</span><span class="ch">\\</span><span class="st">airbnb,price,-1,-1;minimum_nights_avg_ntm </span><span class="ch">\"</span><span class="st">minimum_nights_avg_ntm</span><span class="ch">\"</span><span class="st"> true true false 8 Double 0 0,First,#,C:</span><span class="ch">\\</span><span class="st">Users</span><span class="ch">\\</span><span class="st">xianl</span><span class="ch">\\</span><span class="st">Documents</span><span class="ch">\\</span><span class="st">ArcGIS</span><span class="ch">\\</span><span class="st">Projects</span><span class="ch">\\</span><span class="st">CASA0007Group</span><span class="ch">\\</span><span class="st">CASA0007Group.gdb</span><span class="ch">\\</span><span class="st">airbnb,minimum_nights_avg_ntm,-1,-1;maximum_nights_avg_ntm </span><span class="ch">\"</span><span class="st">maximum_nights_avg_ntm</span><span class="ch">\"</span><span class="st"> true true false 8 Double 0 0,First,#,C:</span><span class="ch">\\</span><span class="st">Users</span><span class="ch">\\</span><span class="st">xianl</span><span class="ch">\\</span><span class="st">Documents</span><span class="ch">\\</span><span class="st">ArcGIS</span><span class="ch">\\</span><span class="st">Projects</span><span class="ch">\\</span><span class="st">CASA0007Group</span><span class="ch">\\</span><span class="st">CASA0007Group.gdb</span><span class="ch">\\</span><span class="st">airbnb,maximum_nights_avg_ntm,-1,-1;review_scores_rating </span><span class="ch">\"</span><span class="st">review_scores_rating</span><span class="ch">\"</span><span class="st"> true true false 8 Double 0 0,First,#,C:</span><span class="ch">\\</span><span class="st">Users</span><span class="ch">\\</span><span class="st">xianl</span><span class="ch">\\</span><span class="st">Documents</span><span class="ch">\\</span><span class="st">ArcGIS</span><span class="ch">\\</span><span class="st">Projects</span><span class="ch">\\</span><span class="st">CASA0007Group</span><span class="ch">\\</span><span class="st">CASA0007Group.gdb</span><span class="ch">\\</span><span class="st">airbnb,review_scores_rating,-1,-1;review_scores_accuracy </span><span class="ch">\"</span><span class="st">review_scores_accuracy</span><span class="ch">\"</span><span class="st"> true true false 8 Double 0 0,First,#,C:</span><span class="ch">\\</span><span class="st">Users</span><span class="ch">\\</span><span class="st">xianl</span><span class="ch">\\</span><span class="st">Documents</span><span class="ch">\\</span><span class="st">ArcGIS</span><span class="ch">\\</span><span class="st">Projects</span><span class="ch">\\</span><span class="st">CASA0007Group</span><span class="ch">\\</span><span class="st">CASA0007Group.gdb</span><span class="ch">\\</span><span class="st">airbnb,review_scores_accuracy,-1,-1;review_scores_cleanliness </span><span class="ch">\"</span><span class="st">review_scores_cleanliness</span><span class="ch">\"</span><span class="st"> true true false 8 Double 0 0,First,#,C:</span><span class="ch">\\</span><span class="st">Users</span><span class="ch">\\</span><span class="st">xianl</span><span class="ch">\\</span><span class="st">Documents</span><span class="ch">\\</span><span class="st">ArcGIS</span><span class="ch">\\</span><span class="st">Projects</span><span class="ch">\\</span><span class="st">CASA0007Group</span><span class="ch">\\</span><span class="st">CASA0007Group.gdb</span><span class="ch">\\</span><span class="st">airbnb,review_scores_cleanliness,-1,-1;review_scores_checkin </span><span class="ch">\"</span><span class="st">review_scores_checkin</span><span class="ch">\"</span><span class="st"> true true false 8 Double 0 0,First,#,C:</span><span class="ch">\\</span><span class="st">Users</span><span class="ch">\\</span><span class="st">xianl</span><span class="ch">\\</span><span class="st">Documents</span><span class="ch">\\</span><span class="st">ArcGIS</span><span class="ch">\\</span><span class="st">Projects</span><span class="ch">\\</span><span class="st">CASA0007Group</span><span class="ch">\\</span><span class="st">CASA0007Group.gdb</span><span class="ch">\\</span><span class="st">airbnb,review_scores_checkin,-1,-1;review_scores_communication </span><span class="ch">\"</span><span class="st">review_scores_communication</span><span class="ch">\"</span><span class="st"> true true false 8 Double 0 0,First,#,C:</span><span class="ch">\\</span><span class="st">Users</span><span class="ch">\\</span><span class="st">xianl</span><span class="ch">\\</span><span class="st">Documents</span><span class="ch">\\</span><span class="st">ArcGIS</span><span class="ch">\\</span><span class="st">Projects</span><span class="ch">\\</span><span class="st">CASA0007Group</span><span class="ch">\\</span><span class="st">CASA0007Group.gdb</span><span class="ch">\\</span><span class="st">airbnb,review_scores_communication,-1,-1;review_scores_location </span><span class="ch">\"</span><span class="st">review_scores_location</span><span class="ch">\"</span><span class="st"> true true false 8 Double 0 0,First,#,C:</span><span class="ch">\\</span><span class="st">Users</span><span class="ch">\\</span><span class="st">xianl</span><span class="ch">\\</span><span class="st">Documents</span><span class="ch">\\</span><span class="st">ArcGIS</span><span class="ch">\\</span><span class="st">Projects</span><span class="ch">\\</span><span class="st">CASA0007Group</span><span class="ch">\\</span><span class="st">CASA0007Group.gdb</span><span class="ch">\\</span><span class="st">airbnb,review_scores_location,-1,-1;review_scores_value </span><span class="ch">\"</span><span class="st">review_scores_value</span><span class="ch">\"</span><span class="st"> true true false 8 Double 0 0,First,#,C:</span><span class="ch">\\</span><span class="st">Users</span><span class="ch">\\</span><span class="st">xianl</span><span class="ch">\\</span><span class="st">Documents</span><span class="ch">\\</span><span class="st">ArcGIS</span><span class="ch">\\</span><span class="st">Projects</span><span class="ch">\\</span><span class="st">CASA0007Group</span><span class="ch">\\</span><span class="st">CASA0007Group.gdb</span><span class="ch">\\</span><span class="st">airbnb,review_scores_value,-1,-1;instant_bookable </span><span class="ch">\"</span><span class="st">instant_bookable</span><span class="ch">\"</span><span class="st"> true true false 8000 Text 0 0,First,#,C:</span><span class="ch">\\</span><span class="st">Users</span><span class="ch">\\</span><span class="st">xianl</span><span class="ch">\\</span><span class="st">Documents</span><span class="ch">\\</span><span class="st">ArcGIS</span><span class="ch">\\</span><span class="st">Projects</span><span class="ch">\\</span><span class="st">CASA0007Group</span><span class="ch">\\</span><span class="st">CASA0007Group.gdb</span><span class="ch">\\</span><span class="st">airbnb,instant_bookable,0,8000;calculated_host_listings_count </span><span class="ch">\"</span><span class="st">calculated_host_listings_count</span><span class="ch">\"</span><span class="st"> true true false 4 Long 0 0,First,#,C:</span><span class="ch">\\</span><span class="st">Users</span><span class="ch">\\</span><span class="st">xianl</span><span class="ch">\\</span><span class="st">Documents</span><span class="ch">\\</span><span class="st">ArcGIS</span><span class="ch">\\</span><span class="st">Projects</span><span class="ch">\\</span><span class="st">CASA0007Group</span><span class="ch">\\</span><span class="st">CASA0007Group.gdb</span><span class="ch">\\</span><span class="st">airbnb,calculated_host_listings_count,-1,-1;response_time_num </span><span class="ch">\"</span><span class="st">response_time_num</span><span class="ch">\"</span><span class="st"> true true false 4 Long 0 0,First,#,C:</span><span class="ch">\\</span><span class="st">Users</span><span class="ch">\\</span><span class="st">xianl</span><span class="ch">\\</span><span class="st">Documents</span><span class="ch">\\</span><span class="st">ArcGIS</span><span class="ch">\\</span><span class="st">Projects</span><span class="ch">\\</span><span class="st">CASA0007Group</span><span class="ch">\\</span><span class="st">CASA0007Group.gdb</span><span class="ch">\\</span><span class="st">airbnb,response_time_num,-1,-1;type_num </span><span class="ch">\"</span><span class="st">type_num</span><span class="ch">\"</span><span class="st"> true true false 4 Long 0 0,First,#,C:</span><span class="ch">\\</span><span class="st">Users</span><span class="ch">\\</span><span class="st">xianl</span><span class="ch">\\</span><span class="st">Documents</span><span class="ch">\\</span><span class="st">ArcGIS</span><span class="ch">\\</span><span class="st">Projects</span><span class="ch">\\</span><span class="st">CASA0007Group</span><span class="ch">\\</span><span class="st">CASA0007Group.gdb</span><span class="ch">\\</span><span class="st">airbnb,type_num,-1,-1;license_tf </span><span class="ch">\"</span><span class="st">license_tf</span><span class="ch">\"</span><span class="st"> true true false 8000 Text 0 0,First,#,C:</span><span class="ch">\\</span><span class="st">Users</span><span class="ch">\\</span><span class="st">xianl</span><span class="ch">\\</span><span class="st">Documents</span><span class="ch">\\</span><span class="st">ArcGIS</span><span class="ch">\\</span><span class="st">Projects</span><span class="ch">\\</span><span class="st">CASA0007Group</span><span class="ch">\\</span><span class="st">CASA0007Group.gdb</span><span class="ch">\\</span><span class="st">airbnb,license_tf,0,8000;host_location_tf </span><span class="ch">\"</span><span class="st">host_location_tf</span><span class="ch">\"</span><span class="st"> true true false 8000 Text 0 0,First,#,C:</span><span class="ch">\\</span><span class="st">Users</span><span class="ch">\\</span><span class="st">xianl</span><span class="ch">\\</span><span class="st">Documents</span><span class="ch">\\</span><span class="st">ArcGIS</span><span class="ch">\\</span><span class="st">Projects</span><span class="ch">\\</span><span class="st">CASA0007Group</span><span class="ch">\\</span><span class="st">CASA0007Group.gdb</span><span class="ch">\\</span><span class="st">airbnb,host_location_tf,0,8000;host_verifications_num </span><span class="ch">\"</span><span class="st">host_verifications_num</span><span class="ch">\"</span><span class="st"> true true false 4 Long 0 0,First,#,C:</span><span class="ch">\\</span><span class="st">Users</span><span class="ch">\\</span><span class="st">xianl</span><span class="ch">\\</span><span class="st">Documents</span><span class="ch">\\</span><span class="st">ArcGIS</span><span class="ch">\\</span><span class="st">Projects</span><span class="ch">\\</span><span class="st">CASA0007Group</span><span class="ch">\\</span><span class="st">CASA0007Group.gdb</span><span class="ch">\\</span><span class="st">airbnb,host_verifications_num,-1,-1;amenities_num </span><span class="ch">\"</span><span class="st">amenities_num</span><span class="ch">\"</span><span class="st"> true true false 4 Long 0 0,First,#,C:</span><span class="ch">\\</span><span class="st">Users</span><span class="ch">\\</span><span class="st">xianl</span><span class="ch">\\</span><span class="st">Documents</span><span class="ch">\\</span><span class="st">ArcGIS</span><span class="ch">\\</span><span class="st">Projects</span><span class="ch">\\</span><span class="st">CASA0007Group</span><span class="ch">\\</span><span class="st">CASA0007Group.gdb</span><span class="ch">\\</span><span class="st">airbnb,amenities_num,-1,-1;host_duration </span><span class="ch">\"</span><span class="st">host_duration</span><span class="ch">\"</span><span class="st"> true true false 4 Long 0 0,First,#,C:</span><span class="ch">\\</span><span class="st">Users</span><span class="ch">\\</span><span class="st">xianl</span><span class="ch">\\</span><span class="st">Documents</span><span class="ch">\\</span><span class="st">ArcGIS</span><span class="ch">\\</span><span class="st">Projects</span><span class="ch">\\</span><span class="st">CASA0007Group</span><span class="ch">\\</span><span class="st">CASA0007Group.gdb</span><span class="ch">\\</span><span class="st">airbnb,host_duration,-1,-1;pop_past </span><span class="ch">\"</span><span class="st">pop_past</span><span class="ch">\"</span><span class="st"> true true false 8 Double 0 0,First,#,C:</span><span class="ch">\\</span><span class="st">Users</span><span class="ch">\\</span><span class="st">xianl</span><span class="ch">\\</span><span class="st">Documents</span><span class="ch">\\</span><span class="st">ArcGIS</span><span class="ch">\\</span><span class="st">Projects</span><span class="ch">\\</span><span class="st">CASA0007Group</span><span class="ch">\\</span><span class="st">CASA0007Group.gdb</span><span class="ch">\\</span><span class="st">airbnb,pop_past,-1,-1;pop_future </span><span class="ch">\"</span><span class="st">pop_future</span><span class="ch">\"</span><span class="st"> true true false 8 Double 0 0,First,#,C:</span><span class="ch">\\</span><span class="st">Users</span><span class="ch">\\</span><span class="st">xianl</span><span class="ch">\\</span><span class="st">Documents</span><span class="ch">\\</span><span class="st">ArcGIS</span><span class="ch">\\</span><span class="st">Projects</span><span class="ch">\\</span><span class="st">CASA0007Group</span><span class="ch">\\</span><span class="st">CASA0007Group.gdb</span><span class="ch">\\</span><span class="st">airbnb,pop_future,-1,-1;popularity </span><span class="ch">\"</span><span class="st">popularity</span><span class="ch">\"</span><span class="st"> true true false 8 Double 0 0,First,#,C:</span><span class="ch">\\</span><span class="st">Users</span><span class="ch">\\</span><span class="st">xianl</span><span class="ch">\\</span><span class="st">Documents</span><span class="ch">\\</span><span class="st">ArcGIS</span><span class="ch">\\</span><span class="st">Projects</span><span class="ch">\\</span><span class="st">CASA0007Group</span><span class="ch">\\</span><span class="st">CASA0007Group.gdb</span><span class="ch">\\</span><span class="st">airbnb,popularity,-1,-1;dist_attractions </span><span class="ch">\"</span><span class="st">dist_attractions</span><span class="ch">\"</span><span class="st"> true true false 0 Double 0 0,First,#,C:</span><span class="ch">\\</span><span class="st">Users</span><span class="ch">\\</span><span class="st">xianl</span><span class="ch">\\</span><span class="st">Documents</span><span class="ch">\\</span><span class="st">ArcGIS</span><span class="ch">\\</span><span class="st">Projects</span><span class="ch">\\</span><span class="st">CASA0007Group</span><span class="ch">\\</span><span class="st">CASA0007Group.gdb</span><span class="ch">\\</span><span class="st">airbnb,dist_attractions,-1,-1;dist_city </span><span class="ch">\"</span><span class="st">dist_city</span><span class="ch">\"</span><span class="st"> true true false 0 Double 0 0,First,#,C:</span><span class="ch">\\</span><span class="st">Users</span><span class="ch">\\</span><span class="st">xianl</span><span class="ch">\\</span><span class="st">Documents</span><span class="ch">\\</span><span class="st">ArcGIS</span><span class="ch">\\</span><span class="st">Projects</span><span class="ch">\\</span><span class="st">CASA0007Group</span><span class="ch">\\</span><span class="st">CASA0007Group.gdb</span><span class="ch">\\</span><span class="st">airbnb,dist_city,-1,-1;airbnb_count </span><span class="ch">\"</span><span class="st">airbnb_count</span><span class="ch">\"</span><span class="st"> true true false 4 Long 0 0,First,#,C:</span><span class="ch">\\</span><span class="st">Users</span><span class="ch">\\</span><span class="st">xianl</span><span class="ch">\\</span><span class="st">Documents</span><span class="ch">\\</span><span class="st">ArcGIS</span><span class="ch">\\</span><span class="st">Projects</span><span class="ch">\\</span><span class="st">CASA0007Group</span><span class="ch">\\</span><span class="st">CASA0007Group.gdb</span><span class="ch">\\</span><span class="st">airbnb,airbnb_count,-1,-1;average_price </span><span class="ch">\"</span><span class="st">average_price</span><span class="ch">\"</span><span class="st"> true true false 8 Double 0 0,First,#,C:</span><span class="ch">\\</span><span class="st">Users</span><span class="ch">\\</span><span class="st">xianl</span><span class="ch">\\</span><span class="st">Documents</span><span class="ch">\\</span><span class="st">ArcGIS</span><span class="ch">\\</span><span class="st">Projects</span><span class="ch">\\</span><span class="st">CASA0007Group</span><span class="ch">\\</span><span class="st">CASA0007Group.gdb</span><span class="ch">\\</span><span class="st">airbnb,average_price,-1,-1;poi_count </span><span class="ch">\"</span><span class="st">poi_count</span><span class="ch">\"</span><span class="st"> true true false 4 Long 0 0,First,#,C:</span><span class="ch">\\</span><span class="st">Users</span><span class="ch">\\</span><span class="st">xianl</span><span class="ch">\\</span><span class="st">Documents</span><span class="ch">\\</span><span class="st">ArcGIS</span><span class="ch">\\</span><span class="st">Projects</span><span class="ch">\\</span><span class="st">CASA0007Group</span><span class="ch">\\</span><span class="st">CASA0007Group.gdb</span><span class="ch">\\</span><span class="st">airbnb,poi_count,-1,-1;transport_count </span><span class="ch">\"</span><span class="st">transport_count</span><span class="ch">\"</span><span class="st"> true true false 4 Long 0 0,First,#,C:</span><span class="ch">\\</span><span class="st">Users</span><span class="ch">\\</span><span class="st">xianl</span><span class="ch">\\</span><span class="st">Documents</span><span class="ch">\\</span><span class="st">ArcGIS</span><span class="ch">\\</span><span class="st">Projects</span><span class="ch">\\</span><span class="st">CASA0007Group</span><span class="ch">\\</span><span class="st">CASA0007Group.gdb</span><span class="ch">\\</span><span class="st">airbnb,transport_count,-1,-1;hotel_count </span><span class="ch">\"</span><span class="st">hotel_count</span><span class="ch">\"</span><span class="st"> true true false 4 Long 0 0,First,#,C:</span><span class="ch">\\</span><span class="st">Users</span><span class="ch">\\</span><span class="st">xianl</span><span class="ch">\\</span><span class="st">Documents</span><span class="ch">\\</span><span class="st">ArcGIS</span><span class="ch">\\</span><span class="st">Projects</span><span class="ch">\\</span><span class="st">CASA0007Group</span><span class="ch">\\</span><span class="st">CASA0007Group.gdb</span><span class="ch">\\</span><span class="st">airbnb,hotel_count,-1,-1"</span>, config_keyword<span class="op">=</span><span class="st">""</span>)[<span class="dv">0</span>]</span>
<span id="cb3-103"><a href="#cb3-103" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-104"><a href="#cb3-104" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span>(spatial_analysis_csv)</span>
<span id="cb3-105"><a href="#cb3-105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-106"><a href="#cb3-106" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="va">__name__</span> <span class="op">==</span> <span class="st">'__main__'</span>:</span>
<span id="cb3-107"><a href="#cb3-107" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Global Environment settings</span></span>
<span id="cb3-108"><a href="#cb3-108" aria-hidden="true" tabindex="-1"></a>    <span class="cf">with</span> arcpy.EnvManager(scratchWorkspace<span class="op">=</span><span class="vs">r"C:\Users\xianl\Documents\ArcGIS\Projects\CASA0007Group\CASA0007Group.gdb"</span>, workspace<span class="op">=</span><span class="vs">r"C:\Users\xianl\Documents\ArcGIS\Projects\CASA0007Group\CASA0007Group.gdb"</span>):</span>
<span id="cb3-109"><a href="#cb3-109" aria-hidden="true" tabindex="-1"></a>        spatial_analysis()</span>
<span id="cb3-110"><a href="#cb3-110" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-111"><a href="#cb3-111" aria-hidden="true" tabindex="-1"></a>spatial_analysis <span class="op">=</span> pd.read_csv(spatial_analysis())</span>
<span id="cb3-112"><a href="#cb3-112" aria-hidden="true" tabindex="-1"></a>spatial_analysis.info()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;class 'pandas.core.frame.DataFrame'&gt;
RangeIndex: 4932 entries, 0 to 4931
Data columns (total 43 columns):
 #   Column                          Non-Null Count  Dtype  
---  ------                          --------------  -----  
 0   OID_                            4932 non-null   int64  
 1   id                              4932 non-null   float64
 2   host_id                         4932 non-null   int64  
 3   host_response_rate              4932 non-null   int64  
 4   host_acceptance_rate            4932 non-null   float64
 5   host_is_superhost               4932 non-null   object 
 6   host_has_profile_pic            4932 non-null   object 
 7   host_identity_verified          4932 non-null   object 
 8   latitude                        4932 non-null   float64
 9   longitude                       4932 non-null   float64
 10  accommodates                    4932 non-null   int64  
 11  bathrooms                       4932 non-null   float64
 12  bedrooms                        4932 non-null   float64
 13  beds                            4932 non-null   float64
 14  price                           4932 non-null   float64
 15  minimum_nights_avg_ntm          4932 non-null   float64
 16  maximum_nights_avg_ntm          4932 non-null   float64
 17  review_scores_rating            4932 non-null   float64
 18  review_scores_accuracy          4932 non-null   float64
 19  review_scores_cleanliness       4932 non-null   float64
 20  review_scores_checkin           4932 non-null   float64
 21  review_scores_communication     4932 non-null   float64
 22  review_scores_location          4932 non-null   float64
 23  review_scores_value             4932 non-null   float64
 24  instant_bookable                4932 non-null   object 
 25  calculated_host_listings_count  4932 non-null   int64  
 26  response_time_num               4932 non-null   int64  
 27  type_num                        4932 non-null   int64  
 28  license_tf                      4932 non-null   object 
 29  host_location_tf                4932 non-null   object 
 30  host_verifications_num          4932 non-null   int64  
 31  amenities_num                   4932 non-null   int64  
 32  host_duration                   4932 non-null   int64  
 33  pop_past                        4932 non-null   float64
 34  pop_future                      4932 non-null   float64
 35  popularity                      4932 non-null   float64
 36  dist_attractions                4932 non-null   float64
 37  dist_city                       4932 non-null   float64
 38  airbnb_count                    4932 non-null   int64  
 39  average_price                   4932 non-null   float64
 40  poi_count                       4932 non-null   int64  
 41  transport_count                 4932 non-null   int64  
 42  hotel_count                     4932 non-null   int64  
dtypes: float64(23), int64(14), object(6)
memory usage: 1.6+ MB</code></pre>
</div>
</div>
<div class="cell" data-execution_count="112">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Contributor: Danming Cao</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="co">#对host_id进行探索并查看不重复的host_id 的数量</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>total <span class="op">=</span> <span class="bu">len</span>(spatial_analysis[<span class="st">'host_id'</span>].unique())</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>percent <span class="op">=</span> <span class="bu">len</span>(spatial_analysis[<span class="st">'host_id'</span>].unique())<span class="op">/</span>spatial_analysis.shape[<span class="dv">0</span>]</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'Unique num of host_id:</span><span class="sc">{</span>total<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'precent:</span><span class="sc">{</span>percent<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a><span class="co">#latitude and longitude对经纬度分布进行探索</span></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>fig, axes <span class="op">=</span> plt.subplots(<span class="dv">1</span>,<span class="dv">3</span>, figsize<span class="op">=</span>(<span class="dv">21</span>,<span class="dv">6</span>))</span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>sn.distplot(spatial_analysis[<span class="st">'latitude'</span>], ax <span class="op">=</span> axes[<span class="dv">0</span>])</span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>sn.distplot(spatial_analysis[<span class="st">'longitude'</span>], ax <span class="op">=</span> axes[<span class="dv">1</span>])</span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>sn.scatterplot(x <span class="op">=</span> spatial_analysis[<span class="st">'latitude'</span>], y <span class="op">=</span> spatial_analysis[<span class="st">'longitude'</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Unique num of host_id:2964
precent:0.6009732360097324</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="112">
<pre><code>&lt;AxesSubplot:xlabel='latitude', ylabel='longitude'&gt;</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="Spatial_files/figure-html/cell-5-output-3.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="113">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Contributor: Yankang Yu</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="co">#Clustering of Price</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="co">#Read Data</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>seattle <span class="op">=</span> spatial_analysis</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a><span class="co">#Relative_Price：Price - Average_Price</span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>seattle[<span class="st">'relative_price'</span>] <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(seattle[<span class="st">'price'</span>])):</span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>    seattle[<span class="st">'relative_price'</span>] <span class="op">=</span> seattle[<span class="st">'price'</span>] <span class="op">-</span> seattle[<span class="st">'average_price'</span>]</span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>seattle</span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a><span class="co">#When num_cluster=3, Silhouette Score is the Highest</span></span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>seattle_sub <span class="op">=</span> seattle.loc[:,[<span class="st">'price'</span>,<span class="st">'relative_price'</span>]]</span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>seattle_sub.columns <span class="op">=</span> [<span class="st">'price'</span>, <span class="st">'relative_price'</span>]</span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>num_clusters <span class="op">=</span> <span class="dv">3</span></span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a>random_state_seed <span class="op">=</span> <span class="dv">100</span></span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a>kmeans_output <span class="op">=</span> sklc.KMeans(n_clusters <span class="op">=</span> num_clusters, random_state <span class="op">=</span> random_state_seed).fit(seattle_sub)</span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a>clustering_ids_kmeans <span class="op">=</span> kmeans_output.labels_</span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(clustering_ids_kmeans)</span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a>seattle_sub <span class="op">=</span> seattle_sub.assign(cluster_id <span class="op">=</span> clustering_ids_kmeans)</span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-24"><a href="#cb8-24" aria-hidden="true" tabindex="-1"></a><span class="co">#Plot the Result of Clustering</span></span>
<span id="cb8-25"><a href="#cb8-25" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize <span class="op">=</span> (<span class="dv">12</span>,<span class="dv">8</span>))</span>
<span id="cb8-26"><a href="#cb8-26" aria-hidden="true" tabindex="-1"></a><span class="co">#Number of Clusters</span></span>
<span id="cb8-27"><a href="#cb8-27" aria-hidden="true" tabindex="-1"></a>n_clusters <span class="op">=</span> seattle_sub.cluster_id.nunique()</span>
<span id="cb8-28"><a href="#cb8-28" aria-hidden="true" tabindex="-1"></a><span class="co">#Get Discrete Colormap</span></span>
<span id="cb8-29"><a href="#cb8-29" aria-hidden="true" tabindex="-1"></a>cmap <span class="op">=</span> plt.get_cmap(<span class="st">'Spectral'</span>,n_clusters)</span>
<span id="cb8-30"><a href="#cb8-30" aria-hidden="true" tabindex="-1"></a><span class="co">#Scatter Points</span></span>
<span id="cb8-31"><a href="#cb8-31" aria-hidden="true" tabindex="-1"></a>scatter <span class="op">=</span> ax.scatter(seattle_sub.price, seattle_sub.relative_price, c <span class="op">=</span> seattle_sub.cluster_id, cmap <span class="op">=</span> cmap)</span>
<span id="cb8-32"><a href="#cb8-32" aria-hidden="true" tabindex="-1"></a>ax.set_xlabel(<span class="st">'price'</span>)</span>
<span id="cb8-33"><a href="#cb8-33" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(<span class="st">'relative_price'</span>)</span>
<span id="cb8-34"><a href="#cb8-34" aria-hidden="true" tabindex="-1"></a>ax.set_title(<span class="st">'Clustering result'</span>)</span>
<span id="cb8-35"><a href="#cb8-35" aria-hidden="true" tabindex="-1"></a><span class="co">#Add Colorbar</span></span>
<span id="cb8-36"><a href="#cb8-36" aria-hidden="true" tabindex="-1"></a>cbar <span class="op">=</span> plt.colorbar(scatter)</span>
<span id="cb8-37"><a href="#cb8-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-38"><a href="#cb8-38" aria-hidden="true" tabindex="-1"></a><span class="co">#Calculate the Silhouette_Score When num_cluster = 3,4,5</span></span>
<span id="cb8-39"><a href="#cb8-39" aria-hidden="true" tabindex="-1"></a>silhouette_kmeans <span class="op">=</span> sklm.silhouette_score(seattle_sub,clustering_ids_kmeans) <span class="co">#(data points,labels of clusters)</span></span>
<span id="cb8-40"><a href="#cb8-40" aria-hidden="true" tabindex="-1"></a>df_silhouette_score <span class="op">=</span> pd.DataFrame({<span class="st">'n_cluster'</span>:[<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>], <span class="st">'silhouette_score'</span>:[<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>]})</span>
<span id="cb8-41"><a href="#cb8-41" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> index, row <span class="kw">in</span> df_silhouette_score.iterrows():</span>
<span id="cb8-42"><a href="#cb8-42" aria-hidden="true" tabindex="-1"></a>    n_clusters <span class="op">=</span> row[<span class="st">'n_cluster'</span>]</span>
<span id="cb8-43"><a href="#cb8-43" aria-hidden="true" tabindex="-1"></a>    clusterer <span class="op">=</span> sklc.KMeans(n_clusters <span class="op">=</span> n_clusters, random_state <span class="op">=</span> random_state_seed).fit(seattle_sub)</span>
<span id="cb8-44"><a href="#cb8-44" aria-hidden="true" tabindex="-1"></a>    cluster_labels <span class="op">=</span> clusterer.labels_</span>
<span id="cb8-45"><a href="#cb8-45" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The silhouette_score Gives the Average Value for All the Samples.</span></span>
<span id="cb8-46"><a href="#cb8-46" aria-hidden="true" tabindex="-1"></a>    <span class="co"># This Gives a Perspective Into the Density and Separation of the Formed Clusters</span></span>
<span id="cb8-47"><a href="#cb8-47" aria-hidden="true" tabindex="-1"></a>    silhouette_avg <span class="op">=</span> sklm.silhouette_score(seattle_sub, cluster_labels)</span>
<span id="cb8-48"><a href="#cb8-48" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(</span>
<span id="cb8-49"><a href="#cb8-49" aria-hidden="true" tabindex="-1"></a>        <span class="st">"For n_clusters ="</span>,</span>
<span id="cb8-50"><a href="#cb8-50" aria-hidden="true" tabindex="-1"></a>        n_clusters,</span>
<span id="cb8-51"><a href="#cb8-51" aria-hidden="true" tabindex="-1"></a>        <span class="st">"The average silhouette_score is :"</span>,</span>
<span id="cb8-52"><a href="#cb8-52" aria-hidden="true" tabindex="-1"></a>        silhouette_avg,</span>
<span id="cb8-53"><a href="#cb8-53" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb8-54"><a href="#cb8-54" aria-hidden="true" tabindex="-1"></a>    row[<span class="st">'silhouette_score'</span>] <span class="op">=</span> silhouette_avg</span>
<span id="cb8-55"><a href="#cb8-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-56"><a href="#cb8-56" aria-hidden="true" tabindex="-1"></a><span class="co">#Merge the Data</span></span>
<span id="cb8-57"><a href="#cb8-57" aria-hidden="true" tabindex="-1"></a>class_price <span class="op">=</span> pd.concat([seattle, seattle_sub.iloc[:,<span class="dv">2</span>]], axis <span class="op">=</span> <span class="dv">1</span>)</span>
<span id="cb8-58"><a href="#cb8-58" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"count of lower price ="</span>, <span class="bu">len</span>(class_price[class_price[<span class="st">"cluster_id"</span>] <span class="op">==</span> <span class="dv">0</span>]))</span>
<span id="cb8-59"><a href="#cb8-59" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"count of medium price ="</span>, <span class="bu">len</span>(class_price[class_price[<span class="st">"cluster_id"</span>] <span class="op">==</span> <span class="dv">1</span>]))</span>
<span id="cb8-60"><a href="#cb8-60" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"count of higher price ="</span>, <span class="bu">len</span>(class_price[class_price[<span class="st">"cluster_id"</span>] <span class="op">==</span> <span class="dv">2</span>]))</span>
<span id="cb8-61"><a href="#cb8-61" aria-hidden="true" tabindex="-1"></a><span class="co">#2-highest price</span></span>
<span id="cb8-62"><a href="#cb8-62" aria-hidden="true" tabindex="-1"></a><span class="co">#1-medium price</span></span>
<span id="cb8-63"><a href="#cb8-63" aria-hidden="true" tabindex="-1"></a><span class="co">#0-lowest price</span></span>
<span id="cb8-64"><a href="#cb8-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-65"><a href="#cb8-65" aria-hidden="true" tabindex="-1"></a><span class="co">#Output</span></span>
<span id="cb8-66"><a href="#cb8-66" aria-hidden="true" tabindex="-1"></a>class_price.to_csv(<span class="st">'class_price.csv'</span>,index <span class="op">=</span> <span class="va">False</span>,header <span class="op">=</span> <span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[0 0 1 ... 0 0 2]
For n_clusters = 3 The average silhouette_score is : 0.5638873478117749
For n_clusters = 4 The average silhouette_score is : 0.5009703914658085
For n_clusters = 5 The average silhouette_score is : 0.43348910162169624</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="Spatial_files/figure-html/cell-6-output-2.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="114">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Contributor: Lu Zhao</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="co">#outlier check</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>plt.boxplot(class_price[<span class="st">'price'</span>], manage_ticks<span class="op">=</span>(<span class="va">False</span>))</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"price"</span>)</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>plt.boxplot(class_price[<span class="st">'host_response_rate'</span>], manage_ticks<span class="op">=</span>(<span class="va">False</span>))</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"host_response_rate"</span>)</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>plt.boxplot(class_price[<span class="st">'response_time_num'</span>], manage_ticks<span class="op">=</span>(<span class="va">False</span>))</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"response_time_num"</span>)</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>plt.boxplot(class_price[<span class="st">'host_verifications_num'</span>], manage_ticks<span class="op">=</span>(<span class="va">False</span>))</span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"host_verifications_num"</span>)</span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>plt.boxplot(class_price[<span class="st">'pop_past'</span>], manage_ticks<span class="op">=</span>(<span class="va">False</span>))</span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"pop_past"</span>)</span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>plt.boxplot(class_price[<span class="st">'pop_future'</span>], manage_ticks<span class="op">=</span>(<span class="va">False</span>))</span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"pop_future"</span>)</span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a>plt.boxplot(class_price[<span class="st">'popularity'</span>], manage_ticks<span class="op">=</span>(<span class="va">False</span>))</span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"popularity"</span>)</span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a>plt.boxplot(class_price[<span class="st">'relative_price'</span>], manage_ticks<span class="op">=</span>(<span class="va">False</span>))</span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"relative_meanprice"</span>)</span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a>plt.boxplot(class_price[<span class="st">'relative_price'</span>], manage_ticks<span class="op">=</span>(<span class="va">False</span>))</span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"relative_price"</span>)</span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true" tabindex="-1"></a>plt.boxplot(class_price[<span class="st">'host_duration'</span>], manage_ticks<span class="op">=</span>(<span class="va">False</span>))</span>
<span id="cb10-23"><a href="#cb10-23" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"host_duration"</span>)</span>
<span id="cb10-24"><a href="#cb10-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-25"><a href="#cb10-25" aria-hidden="true" tabindex="-1"></a><span class="co"># IQR</span></span>
<span id="cb10-26"><a href="#cb10-26" aria-hidden="true" tabindex="-1"></a>Q1 <span class="op">=</span> np.percentile(class_price[<span class="st">'price'</span>], <span class="dv">25</span>,interpolation <span class="op">=</span> <span class="st">'midpoint'</span>)</span>
<span id="cb10-27"><a href="#cb10-27" aria-hidden="true" tabindex="-1"></a>Q3 <span class="op">=</span> np.percentile(class_price[<span class="st">'price'</span>], <span class="dv">75</span>,interpolation <span class="op">=</span> <span class="st">'midpoint'</span>)</span>
<span id="cb10-28"><a href="#cb10-28" aria-hidden="true" tabindex="-1"></a>IQR <span class="op">=</span> Q3 <span class="op">-</span> Q1</span>
<span id="cb10-29"><a href="#cb10-29" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Old Shape: "</span>, class_price.shape)</span>
<span id="cb10-30"><a href="#cb10-30" aria-hidden="true" tabindex="-1"></a><span class="co"># Upper bound</span></span>
<span id="cb10-31"><a href="#cb10-31" aria-hidden="true" tabindex="-1"></a>upper <span class="op">=</span> np.where(class_price[<span class="st">'price'</span>] <span class="op">&gt;=</span> (Q3<span class="op">+</span><span class="fl">1.5</span><span class="op">*</span>IQR))</span>
<span id="cb10-32"><a href="#cb10-32" aria-hidden="true" tabindex="-1"></a><span class="co"># Lower bound</span></span>
<span id="cb10-33"><a href="#cb10-33" aria-hidden="true" tabindex="-1"></a>lower <span class="op">=</span> np.where(class_price[<span class="st">'price'</span>] <span class="op">&lt;=</span> (Q1<span class="op">-</span><span class="fl">1.5</span><span class="op">*</span>IQR))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Old Shape:  (4932, 45)</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="Spatial_files/figure-html/cell-7-output-2.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="115">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Contributor: Xianlai Yin</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="co">#Variable Selection</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a><span class="co">#Data Preparation and Clean</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>seattle_dum <span class="op">=</span> pd.get_dummies(class_price)</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>seattle <span class="op">=</span> seattle_dum.drop(labels<span class="op">=</span>[<span class="st">'OID_'</span>,<span class="st">'id'</span>,<span class="st">'host_id'</span>,<span class="st">'host_response_rate'</span>,<span class="st">'calculated_host_listings_count'</span>,<span class="st">'beds'</span>,<span class="st">'airbnb_count'</span>,<span class="st">'hotel_count'</span>,<span class="st">'review_scores_accuracy'</span>,<span class="st">'review_scores_cleanliness'</span>, <span class="st">'review_scores_checkin'</span>,<span class="st">'review_scores_communication'</span>, <span class="st">'review_scores_location'</span>,<span class="st">'review_scores_value'</span>,<span class="st">'latitude'</span>, <span class="st">'longitude'</span>,<span class="st">'relative_price'</span>,<span class="st">'pop_past'</span>,<span class="st">'pop_future'</span>,<span class="st">'host_is_superhost_f'</span>,<span class="st">'host_has_profile_pic_f'</span>,<span class="st">'host_identity_verified_f'</span>,<span class="st">'instant_bookable_f'</span>,<span class="st">'license_tf_f'</span>,<span class="st">'host_location_tf_f'</span>], axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a><span class="co">#Def VIF</span></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> drop_column_using_vif_(df, thresh<span class="op">=</span><span class="dv">5</span>):</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> <span class="va">True</span>:</span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>        df_with_const <span class="op">=</span> add_constant(df)</span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>        vif_df <span class="op">=</span> pd.Series([variance_inflation_factor(df_with_const.values, i) </span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>               <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(df_with_const.shape[<span class="dv">1</span>])], name<span class="op">=</span> <span class="st">"VIF"</span>,</span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>              index<span class="op">=</span>df_with_const.columns).to_frame()</span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>        vif_df <span class="op">=</span> vif_df.drop(<span class="st">'const'</span>)</span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> vif_df.VIF.<span class="bu">max</span>() <span class="op">&gt;</span> thresh:</span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>            index_to_drop <span class="op">=</span> vif_df.index[vif_df.VIF <span class="op">==</span> vif_df.VIF.<span class="bu">max</span>()].tolist()[<span class="dv">0</span>]</span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="st">'Dropping: </span><span class="sc">{}</span><span class="st">'</span>.<span class="bu">format</span>(index_to_drop))</span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a>            df <span class="op">=</span> df.drop(columns <span class="op">=</span> index_to_drop)</span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a>            <span class="cf">break</span></span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> df</span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a><span class="co">#VIF</span></span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true" tabindex="-1"></a>seattle <span class="op">=</span> seattle.dropna(axis<span class="op">=</span><span class="dv">0</span>, how <span class="op">=</span> <span class="st">'any'</span>)</span>
<span id="cb12-27"><a href="#cb12-27" aria-hidden="true" tabindex="-1"></a>seattle_VIF <span class="op">=</span> drop_column_using_vif_(seattle)</span>
<span id="cb12-28"><a href="#cb12-28" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(seattle_VIF.columns)</span>
<span id="cb12-29"><a href="#cb12-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-30"><a href="#cb12-30" aria-hidden="true" tabindex="-1"></a><span class="co">#Normality Test</span></span>
<span id="cb12-31"><a href="#cb12-31" aria-hidden="true" tabindex="-1"></a>kstest <span class="op">=</span> scipy.stats.kstest(seattle_VIF[<span class="st">'price'</span>],cdf <span class="op">=</span> <span class="st">"norm"</span>)</span>
<span id="cb12-32"><a href="#cb12-32" aria-hidden="true" tabindex="-1"></a>normaltest <span class="op">=</span> scipy.stats.normaltest(seattle_VIF[<span class="st">'price'</span>])</span>
<span id="cb12-33"><a href="#cb12-33" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(kstest)</span>
<span id="cb12-34"><a href="#cb12-34" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(normaltest)</span>
<span id="cb12-35"><a href="#cb12-35" aria-hidden="true" tabindex="-1"></a><span class="co">#ln(y) and Compare it with y </span></span>
<span id="cb12-36"><a href="#cb12-36" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> kstest.pvalue <span class="op">&lt;</span> <span class="fl">0.05</span> <span class="kw">and</span> normaltest.pvalue <span class="op">&lt;</span> <span class="fl">0.05</span>:</span>
<span id="cb12-37"><a href="#cb12-37" aria-hidden="true" tabindex="-1"></a>    seattle_VIF[<span class="st">'price_log'</span>] <span class="op">=</span> <span class="st">""</span></span>
<span id="cb12-38"><a href="#cb12-38" aria-hidden="true" tabindex="-1"></a>    seattle_VIF[<span class="st">'price_log'</span>] <span class="op">=</span> seattle_VIF[<span class="st">'price'</span>].<span class="bu">apply</span>(np.log)</span>
<span id="cb12-39"><a href="#cb12-39" aria-hidden="true" tabindex="-1"></a><span class="co">#Plot the Difference</span></span>
<span id="cb12-40"><a href="#cb12-40" aria-hidden="true" tabindex="-1"></a>plt.figure(dpi<span class="op">=</span><span class="dv">100</span>,figsize<span class="op">=</span>(<span class="dv">8</span>,<span class="dv">6</span>))</span>
<span id="cb12-41"><a href="#cb12-41" aria-hidden="true" tabindex="-1"></a>plt.subplot(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">1</span>)</span>
<span id="cb12-42"><a href="#cb12-42" aria-hidden="true" tabindex="-1"></a>seattle_VIF[<span class="st">'price'</span>].hist()</span>
<span id="cb12-43"><a href="#cb12-43" aria-hidden="true" tabindex="-1"></a>plt.subplot(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">2</span>)</span>
<span id="cb12-44"><a href="#cb12-44" aria-hidden="true" tabindex="-1"></a>seattle_VIF[<span class="st">'price_log'</span>].hist()</span>
<span id="cb12-45"><a href="#cb12-45" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb12-46"><a href="#cb12-46" aria-hidden="true" tabindex="-1"></a><span class="co">#qqplot拟合曲线</span></span>
<span id="cb12-47"><a href="#cb12-47" aria-hidden="true" tabindex="-1"></a>sm.qqplot(seattle_VIF[<span class="st">'price'</span>], fit<span class="op">=</span><span class="va">True</span>, line<span class="op">=</span><span class="st">'45'</span>)</span>
<span id="cb12-48"><a href="#cb12-48" aria-hidden="true" tabindex="-1"></a>sm.qqplot(seattle_VIF[<span class="st">'price_log'</span>], fit<span class="op">=</span><span class="va">True</span>, line<span class="op">=</span><span class="st">'45'</span>)</span>
<span id="cb12-49"><a href="#cb12-49" aria-hidden="true" tabindex="-1"></a><span class="co">#Show the Difference of rsquare</span></span>
<span id="cb12-50"><a href="#cb12-50" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> sm.OLS(endog <span class="op">=</span> seattle_VIF[<span class="st">'price'</span>], exog <span class="op">=</span> sm.add_constant(seattle_VIF.drop(labels<span class="op">=</span>[<span class="st">'cluster_id'</span>,<span class="st">'price'</span>,<span class="st">'price_log'</span>], axis<span class="op">=</span><span class="dv">1</span>))).fit()</span>
<span id="cb12-51"><a href="#cb12-51" aria-hidden="true" tabindex="-1"></a>spatial_analysis[<span class="st">'price'</span>] <span class="op">=</span> np.log1p(spatial_analysis[<span class="st">'price'</span>])</span>
<span id="cb12-52"><a href="#cb12-52" aria-hidden="true" tabindex="-1"></a>yrsq <span class="op">=</span> y.rsquared</span>
<span id="cb12-53"><a href="#cb12-53" aria-hidden="true" tabindex="-1"></a>lny <span class="op">=</span> sm.OLS(endog <span class="op">=</span> seattle_VIF[<span class="st">'price_log'</span>], exog <span class="op">=</span> sm.add_constant(seattle_VIF.drop(labels<span class="op">=</span>[<span class="st">'cluster_id'</span>,<span class="st">'price'</span>,<span class="st">'price_log'</span>], axis<span class="op">=</span><span class="dv">1</span>))).fit()</span>
<span id="cb12-54"><a href="#cb12-54" aria-hidden="true" tabindex="-1"></a>lnyrsq <span class="op">=</span> lny.rsquared</span>
<span id="cb12-55"><a href="#cb12-55" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"rsquared of y:"</span>,yrsq,<span class="st">", rsquared of ln(y):"</span>,lnyrsq)</span>
<span id="cb12-56"><a href="#cb12-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-57"><a href="#cb12-57" aria-hidden="true" tabindex="-1"></a><span class="co">#Pearson Correlation Coefficient</span></span>
<span id="cb12-58"><a href="#cb12-58" aria-hidden="true" tabindex="-1"></a>seattle_corr <span class="op">=</span> seattle_VIF</span>
<span id="cb12-59"><a href="#cb12-59" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(seattle_VIF.columns)):</span>
<span id="cb12-60"><a href="#cb12-60" aria-hidden="true" tabindex="-1"></a>    pearson <span class="op">=</span> pearsonr(seattle_VIF[seattle_VIF.columns[i]], seattle_VIF[<span class="st">'price_log'</span>])</span>
<span id="cb12-61"><a href="#cb12-61" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> pearson[<span class="dv">1</span>] <span class="op">&lt;</span> <span class="fl">0.05</span>:</span>
<span id="cb12-62"><a href="#cb12-62" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(seattle_VIF.columns[i],<span class="st">"( r ="</span>,pearson[<span class="dv">0</span>],<span class="st">")"</span>)</span>
<span id="cb12-63"><a href="#cb12-63" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb12-64"><a href="#cb12-64" aria-hidden="true" tabindex="-1"></a>        seattle_corr <span class="op">=</span> seattle_corr.drop(labels<span class="op">=</span>[seattle_VIF.columns[i]], axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb12-65"><a href="#cb12-65" aria-hidden="true" tabindex="-1"></a><span class="co">#Checking the Correlation Between Variables</span></span>
<span id="cb12-66"><a href="#cb12-66" aria-hidden="true" tabindex="-1"></a>f <span class="op">=</span> plt.figure(figsize<span class="op">=</span>(<span class="dv">30</span>, <span class="dv">20</span>))</span>
<span id="cb12-67"><a href="#cb12-67" aria-hidden="true" tabindex="-1"></a>sn.heatmap(seattle_corr.corr(),annot<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb12-68"><a href="#cb12-68" aria-hidden="true" tabindex="-1"></a>plt.xticks(<span class="bu">range</span>(seattle_corr.shape[<span class="dv">1</span>]), seattle_corr.columns, fontsize<span class="op">=</span><span class="dv">14</span>, rotation<span class="op">=</span><span class="dv">90</span>)</span>
<span id="cb12-69"><a href="#cb12-69" aria-hidden="true" tabindex="-1"></a>plt.yticks(<span class="bu">range</span>(seattle_corr.shape[<span class="dv">1</span>]), seattle_corr.columns, fontsize<span class="op">=</span><span class="dv">14</span>)</span>
<span id="cb12-70"><a href="#cb12-70" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Index(['host_acceptance_rate', 'accommodates', 'bathrooms', 'bedrooms',
       'price', 'minimum_nights_avg_ntm', 'maximum_nights_avg_ntm',
       'review_scores_rating', 'response_time_num', 'type_num',
       'host_verifications_num', 'amenities_num', 'host_duration',
       'popularity', 'dist_attractions', 'dist_city', 'average_price',
       'poi_count', 'transport_count', 'cluster_id', 'host_is_superhost_t',
       'host_has_profile_pic_t', 'host_identity_verified_t',
       'instant_bookable_t', 'license_tf_t', 'host_location_tf_t'],
      dtype='object')
KstestResult(statistic=1.0, pvalue=0.0)
NormaltestResult(statistic=3923.1727360570785, pvalue=0.0)</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="Spatial_files/figure-html/cell-8-output-2.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>rsquared of y: 0.5696477534537507 , rsquared of ln(y): 0.66424257065734
host_acceptance_rate ( r = 0.07459339490342584 )
accommodates ( r = 0.6671767190097946 )
bathrooms ( r = 0.5206090823913927 )
bedrooms ( r = 0.6232871844714722 )
price ( r = 0.8960873560489293 )
maximum_nights_avg_ntm ( r = -0.04990770324684194 )
review_scores_rating ( r = 0.10143208725330646 )
response_time_num ( r = 0.10975642607539293 )
type_num ( r = 0.46812997011457536 )
host_verifications_num ( r = 0.031264652652906816 )
amenities_num ( r = 0.26315011107370884 )
host_duration ( r = -0.06717899728358293 )
popularity ( r = -0.09009500443833529 )
dist_attractions ( r = -0.1069354950302189 )
dist_city ( r = -0.20417210789579765 )
average_price ( r = 0.42486098438427683 )
poi_count ( r = 0.11088932094758325 )
transport_count ( r = 0.10229173798155645 )
cluster_id ( r = 0.6974745931568405 )
host_is_superhost_t ( r = 0.04921610653267982 )
instant_bookable_t ( r = 0.04434034154796674 )
license_tf_t ( r = 0.20007987682809775 )
host_location_tf_t ( r = -0.08685051592908824 )
price_log ( r = 1.0 )</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="Spatial_files/figure-html/cell-8-output-4.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="Spatial_files/figure-html/cell-8-output-5.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="Spatial_files/figure-html/cell-8-output-6.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="116">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Contributor: Xianlai Yin</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="co">#OLS_price</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>OLS_y <span class="op">=</span> seattle_corr[<span class="st">'price_log'</span>]</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>OLS_x <span class="op">=</span> seattle_corr.drop(labels<span class="op">=</span>[<span class="st">'price'</span>,<span class="st">'price_log'</span>,<span class="st">'cluster_id'</span>], axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>OLS_price <span class="op">=</span> sm.OLS(endog <span class="op">=</span> OLS_y, exog <span class="op">=</span> sm.add_constant(OLS_x)).fit()</span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>OLS_price.summary()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="116">

<table class="simpletable">
<caption>OLS Regression Results</caption>
<tbody><tr>
  <th>Dep. Variable:</th>       <td>price_log</td>    <th>  R-squared:         </th> <td>   0.664</td>
</tr>
<tr>
  <th>Model:</th>                  <td>OLS</td>       <th>  Adj. R-squared:    </th> <td>   0.663</td>
</tr>
<tr>
  <th>Method:</th>            <td>Least Squares</td>  <th>  F-statistic:       </th> <td>   462.0</td>
</tr>
<tr>
  <th>Date:</th>             <td>周一, 12 12月 2022</td> <th>  Prob (F-statistic):</th>  <td>  0.00</td> 
</tr>
<tr>
  <th>Time:</th>                <td>03:52:51</td>     <th>  Log-Likelihood:    </th> <td> -1426.7</td>
</tr>
<tr>
  <th>No. Observations:</th>     <td>  4932</td>      <th>  AIC:               </th> <td>   2897.</td>
</tr>
<tr>
  <th>Df Residuals:</th>         <td>  4910</td>      <th>  BIC:               </th> <td>   3041.</td>
</tr>
<tr>
  <th>Df Model:</th>             <td>    21</td>      <th>                     </th>     <td> </td>   
</tr>
<tr>
  <th>Covariance Type:</th>     <td>nonrobust</td>    <th>                     </th>     <td> </td>   
</tr>
</tbody></table>
<table class="simpletable">
<tbody><tr>
             <td></td>               <th>coef</th>     <th>std err</th>      <th>t</th>      <th>P&gt;|t|</th>  <th>[0.025</th>    <th>0.975]</th>  
</tr>
<tr>
  <th>const</th>                  <td>    2.1607</td> <td>    0.087</td> <td>   24.856</td> <td> 0.000</td> <td>    1.990</td> <td>    2.331</td>
</tr>
<tr>
  <th>host_acceptance_rate</th>   <td>   -0.0010</td> <td>    0.000</td> <td>   -3.882</td> <td> 0.000</td> <td>   -0.002</td> <td>   -0.000</td>
</tr>
<tr>
  <th>accommodates</th>           <td>    0.0457</td> <td>    0.004</td> <td>   12.416</td> <td> 0.000</td> <td>    0.038</td> <td>    0.053</td>
</tr>
<tr>
  <th>bathrooms</th>              <td>    0.1139</td> <td>    0.009</td> <td>   12.053</td> <td> 0.000</td> <td>    0.095</td> <td>    0.132</td>
</tr>
<tr>
  <th>bedrooms</th>               <td>    0.1294</td> <td>    0.008</td> <td>   15.427</td> <td> 0.000</td> <td>    0.113</td> <td>    0.146</td>
</tr>
<tr>
  <th>maximum_nights_avg_ntm</th> <td>-4.841e-05</td> <td>    1e-05</td> <td>   -4.823</td> <td> 0.000</td> <td>-6.81e-05</td> <td>-2.87e-05</td>
</tr>
<tr>
  <th>review_scores_rating</th>   <td>    0.1171</td> <td>    0.015</td> <td>    7.943</td> <td> 0.000</td> <td>    0.088</td> <td>    0.146</td>
</tr>
<tr>
  <th>response_time_num</th>      <td>    0.0255</td> <td>    0.006</td> <td>    4.581</td> <td> 0.000</td> <td>    0.015</td> <td>    0.036</td>
</tr>
<tr>
  <th>type_num</th>               <td>    0.3891</td> <td>    0.014</td> <td>   27.785</td> <td> 0.000</td> <td>    0.362</td> <td>    0.417</td>
</tr>
<tr>
  <th>host_verifications_num</th> <td>    0.0357</td> <td>    0.011</td> <td>    3.290</td> <td> 0.001</td> <td>    0.014</td> <td>    0.057</td>
</tr>
<tr>
  <th>amenities_num</th>          <td>    0.0032</td> <td>    0.000</td> <td>    8.292</td> <td> 0.000</td> <td>    0.002</td> <td>    0.004</td>
</tr>
<tr>
  <th>host_duration</th>          <td>-7.859e-06</td> <td> 4.89e-06</td> <td>   -1.609</td> <td> 0.108</td> <td>-1.74e-05</td> <td> 1.72e-06</td>
</tr>
<tr>
  <th>popularity</th>             <td>   -0.0437</td> <td>    0.004</td> <td>  -12.069</td> <td> 0.000</td> <td>   -0.051</td> <td>   -0.037</td>
</tr>
<tr>
  <th>dist_attractions</th>       <td>-8.273e-06</td> <td> 3.67e-06</td> <td>   -2.257</td> <td> 0.024</td> <td>-1.55e-05</td> <td>-1.09e-06</td>
</tr>
<tr>
  <th>dist_city</th>              <td>-7.412e-06</td> <td> 1.84e-06</td> <td>   -4.020</td> <td> 0.000</td> <td> -1.1e-05</td> <td> -3.8e-06</td>
</tr>
<tr>
  <th>average_price</th>          <td>    0.0023</td> <td>    0.000</td> <td>   19.876</td> <td> 0.000</td> <td>    0.002</td> <td>    0.002</td>
</tr>
<tr>
  <th>poi_count</th>              <td>    0.0005</td> <td> 4.77e-05</td> <td>    9.502</td> <td> 0.000</td> <td>    0.000</td> <td>    0.001</td>
</tr>
<tr>
  <th>transport_count</th>        <td>    0.0008</td> <td>    0.001</td> <td>    1.070</td> <td> 0.285</td> <td>   -0.001</td> <td>    0.002</td>
</tr>
<tr>
  <th>host_is_superhost_t</th>    <td>    0.0404</td> <td>    0.011</td> <td>    3.798</td> <td> 0.000</td> <td>    0.020</td> <td>    0.061</td>
</tr>
<tr>
  <th>instant_bookable_t</th>     <td>    0.0103</td> <td>    0.010</td> <td>    1.026</td> <td> 0.305</td> <td>   -0.009</td> <td>    0.030</td>
</tr>
<tr>
  <th>license_tf_t</th>           <td>    0.1085</td> <td>    0.012</td> <td>    8.889</td> <td> 0.000</td> <td>    0.085</td> <td>    0.132</td>
</tr>
<tr>
  <th>host_location_tf_t</th>     <td>   -0.0135</td> <td>    0.012</td> <td>   -1.107</td> <td> 0.268</td> <td>   -0.037</td> <td>    0.010</td>
</tr>
</tbody></table>
<table class="simpletable">
<tbody><tr>
  <th>Omnibus:</th>       <td>425.362</td> <th>  Durbin-Watson:     </th> <td>   1.830</td> 
</tr>
<tr>
  <th>Prob(Omnibus):</th> <td> 0.000</td>  <th>  Jarque-Bera (JB):  </th> <td>1287.302</td> 
</tr>
<tr>
  <th>Skew:</th>          <td> 0.448</td>  <th>  Prob(JB):          </th> <td>2.92e-280</td>
</tr>
<tr>
  <th>Kurtosis:</th>      <td> 5.337</td>  <th>  Cond. No.          </th> <td>1.50e+05</td> 
</tr>
</tbody></table><br><br>Notes:<br>[1] Standard Errors assume that the covariance matrix of the errors is correctly specified.<br>[2] The condition number is large, 1.5e+05. This might indicate that there are<br>strong multicollinearity or other numerical problems.
</div>
</div>
<div class="cell" data-execution_count="117">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Contributor: Xianlai Yin</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="co">#Diagnose the model using residual analysis</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>plt.scatter(OLS_price.fittedvalues, OLS_price.resid)</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'price_log'</span>)</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Residual'</span>)</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>plt.axhline(y<span class="op">=</span><span class="dv">2</span>, color<span class="op">=</span><span class="st">'r'</span>, linestyle<span class="op">=</span><span class="st">'--'</span>)</span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>plt.axhline(y<span class="op">=-</span><span class="dv">2</span>, color<span class="op">=</span><span class="st">'r'</span>, linestyle<span class="op">=</span><span class="st">'--'</span>) </span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a><span class="co">#残差分析正态性检验</span></span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>plt.figure()</span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a>OLS_price.resid.plot.density()</span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a>kstest <span class="op">=</span> scipy.stats.kstest(OLS_price.resid,cdf <span class="op">=</span> <span class="st">"norm"</span>)</span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a>normaltest <span class="op">=</span> scipy.stats.normaltest(OLS_price.resid)</span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(kstest)</span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(normaltest)</span>
<span id="cb16-19"><a href="#cb16-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-20"><a href="#cb16-20" aria-hidden="true" tabindex="-1"></a><span class="co">#残差方齐性检验</span></span>
<span id="cb16-21"><a href="#cb16-21" aria-hidden="true" tabindex="-1"></a><span class="co">#第一个值为LM统计量；第二个值是统计量对应的概率p值；第三个值为F统计量，用于检验残差平方项与自变量之间是否独立，如果独立则表明残差方差齐性；第四个值则为F统计量的概率p值，同样大于0.05，则进一步表示残差项满足方差齐性的假设。</span></span>
<span id="cb16-22"><a href="#cb16-22" aria-hidden="true" tabindex="-1"></a>BP_test <span class="op">=</span> statsmodels.stats.diagnostic.het_breuschpagan(exog_het <span class="op">=</span> OLS_x, resid <span class="op">=</span> OLS_price.resid)</span>
<span id="cb16-23"><a href="#cb16-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-24"><a href="#cb16-24" aria-hidden="true" tabindex="-1"></a><span class="co">#Outlier test</span></span>
<span id="cb16-25"><a href="#cb16-25" aria-hidden="true" tabindex="-1"></a>outliers <span class="op">=</span> OLS_price.get_influence()</span>
<span id="cb16-26"><a href="#cb16-26" aria-hidden="true" tabindex="-1"></a>leverage <span class="op">=</span> outliers.hat_matrix_diag</span>
<span id="cb16-27"><a href="#cb16-27" aria-hidden="true" tabindex="-1"></a>dffts <span class="op">=</span> outliers.dffits[<span class="dv">0</span>]</span>
<span id="cb16-28"><a href="#cb16-28" aria-hidden="true" tabindex="-1"></a>resid_stu <span class="op">=</span> outliers.resid_studentized_external</span>
<span id="cb16-29"><a href="#cb16-29" aria-hidden="true" tabindex="-1"></a>cook <span class="op">=</span>outliers.cooks_distance[<span class="dv">0</span>]</span>
<span id="cb16-30"><a href="#cb16-30" aria-hidden="true" tabindex="-1"></a>contat <span class="op">=</span> pd.concat([pd.Series(leverage,name <span class="op">=</span> <span class="st">"leverage"</span>),pd.Series(dffts,name <span class="op">=</span> <span class="st">"dffts"</span>),pd.Series(resid_stu,name <span class="op">=</span> <span class="st">"resid_stu"</span>),pd.Series(cook,name <span class="op">=</span> <span class="st">"cook"</span>)],axis <span class="op">=</span> <span class="dv">1</span>)</span>
<span id="cb16-31"><a href="#cb16-31" aria-hidden="true" tabindex="-1"></a>seattle_corr.index <span class="op">=</span> <span class="bu">range</span>(seattle_corr.shape[<span class="dv">0</span>])</span>
<span id="cb16-32"><a href="#cb16-32" aria-hidden="true" tabindex="-1"></a>OLS_price_outliers <span class="op">=</span> pd.concat([seattle_corr,contat],axis <span class="op">=</span> <span class="dv">1</span>)</span>
<span id="cb16-33"><a href="#cb16-33" aria-hidden="true" tabindex="-1"></a>OLS_price_outliers.head()</span>
<span id="cb16-34"><a href="#cb16-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-35"><a href="#cb16-35" aria-hidden="true" tabindex="-1"></a><span class="co">#Calculating outlier ratios and outlier handling</span></span>
<span id="cb16-36"><a href="#cb16-36" aria-hidden="true" tabindex="-1"></a>outliers_ratio <span class="op">=</span> <span class="bu">sum</span>(np.where((np.<span class="bu">abs</span>(OLS_price_outliers.resid_stu)<span class="op">&gt;</span><span class="dv">2</span>),<span class="dv">1</span>,<span class="dv">0</span>))<span class="op">/</span>OLS_price_outliers.shape[<span class="dv">0</span>]</span>
<span id="cb16-37"><a href="#cb16-37" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(outliers_ratio)</span>
<span id="cb16-38"><a href="#cb16-38" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> outliers_ratio <span class="op">&lt;</span> <span class="fl">0.05</span>:</span>
<span id="cb16-39"><a href="#cb16-39" aria-hidden="true" tabindex="-1"></a>    none_outliers <span class="op">=</span> seattle_corr.loc[np.<span class="bu">abs</span>(OLS_price_outliers.resid_stu)<span class="op">&lt;=</span><span class="dv">2</span>,]</span>
<span id="cb16-40"><a href="#cb16-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-41"><a href="#cb16-41" aria-hidden="true" tabindex="-1"></a><span class="co">#Re-OLS</span></span>
<span id="cb16-42"><a href="#cb16-42" aria-hidden="true" tabindex="-1"></a>OLS1_y <span class="op">=</span> none_outliers[<span class="st">'price_log'</span>]</span>
<span id="cb16-43"><a href="#cb16-43" aria-hidden="true" tabindex="-1"></a>OLS1_x <span class="op">=</span> none_outliers.drop(labels<span class="op">=</span>[<span class="st">'price'</span>,<span class="st">'price_log'</span>,<span class="st">'cluster_id'</span>], axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb16-44"><a href="#cb16-44" aria-hidden="true" tabindex="-1"></a>OLS1_price <span class="op">=</span> sm.OLS(endog <span class="op">=</span> OLS1_y, exog <span class="op">=</span> sm.add_constant(OLS1_x)).fit()</span>
<span id="cb16-45"><a href="#cb16-45" aria-hidden="true" tabindex="-1"></a>OLS1_price.summary()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="Spatial_files/figure-html/cell-10-output-1.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="Spatial_files/figure-html/cell-10-output-2.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>KstestResult(statistic=0.2611894684794409, pvalue=2.4637834478438078e-297)
NormaltestResult(statistic=425.3620155124059, pvalue=4.3034020841633794e-93)
0.04805352798053528</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="117">

<table class="simpletable">
<caption>OLS Regression Results</caption>
<tbody><tr>
  <th>Dep. Variable:</th>       <td>price_log</td>    <th>  R-squared:         </th> <td>   0.742</td>
</tr>
<tr>
  <th>Model:</th>                  <td>OLS</td>       <th>  Adj. R-squared:    </th> <td>   0.741</td>
</tr>
<tr>
  <th>Method:</th>            <td>Least Squares</td>  <th>  F-statistic:       </th> <td>   639.7</td>
</tr>
<tr>
  <th>Date:</th>             <td>周一, 12 12月 2022</td> <th>  Prob (F-statistic):</th>  <td>  0.00</td> 
</tr>
<tr>
  <th>Time:</th>                <td>03:53:10</td>     <th>  Log-Likelihood:    </th> <td> -392.79</td>
</tr>
<tr>
  <th>No. Observations:</th>     <td>  4695</td>      <th>  AIC:               </th> <td>   829.6</td>
</tr>
<tr>
  <th>Df Residuals:</th>         <td>  4673</td>      <th>  BIC:               </th> <td>   971.6</td>
</tr>
<tr>
  <th>Df Model:</th>             <td>    21</td>      <th>                     </th>     <td> </td>   
</tr>
<tr>
  <th>Covariance Type:</th>     <td>nonrobust</td>    <th>                     </th>     <td> </td>   
</tr>
</tbody></table>
<table class="simpletable">
<tbody><tr>
             <td></td>               <th>coef</th>     <th>std err</th>      <th>t</th>      <th>P&gt;|t|</th>  <th>[0.025</th>    <th>0.975]</th>  
</tr>
<tr>
  <th>const</th>                  <td>    2.2375</td> <td>    0.074</td> <td>   30.344</td> <td> 0.000</td> <td>    2.093</td> <td>    2.382</td>
</tr>
<tr>
  <th>host_acceptance_rate</th>   <td>   -0.0006</td> <td>    0.000</td> <td>   -2.611</td> <td> 0.009</td> <td>   -0.001</td> <td>   -0.000</td>
</tr>
<tr>
  <th>accommodates</th>           <td>    0.0443</td> <td>    0.003</td> <td>   14.183</td> <td> 0.000</td> <td>    0.038</td> <td>    0.050</td>
</tr>
<tr>
  <th>bathrooms</th>              <td>    0.1306</td> <td>    0.009</td> <td>   14.691</td> <td> 0.000</td> <td>    0.113</td> <td>    0.148</td>
</tr>
<tr>
  <th>bedrooms</th>               <td>    0.1265</td> <td>    0.007</td> <td>   17.612</td> <td> 0.000</td> <td>    0.112</td> <td>    0.141</td>
</tr>
<tr>
  <th>maximum_nights_avg_ntm</th> <td>-3.839e-05</td> <td>  8.4e-06</td> <td>   -4.568</td> <td> 0.000</td> <td>-5.49e-05</td> <td>-2.19e-05</td>
</tr>
<tr>
  <th>review_scores_rating</th>   <td>    0.0981</td> <td>    0.012</td> <td>    7.900</td> <td> 0.000</td> <td>    0.074</td> <td>    0.122</td>
</tr>
<tr>
  <th>response_time_num</th>      <td>    0.0172</td> <td>    0.005</td> <td>    3.673</td> <td> 0.000</td> <td>    0.008</td> <td>    0.026</td>
</tr>
<tr>
  <th>type_num</th>               <td>    0.4107</td> <td>    0.012</td> <td>   34.434</td> <td> 0.000</td> <td>    0.387</td> <td>    0.434</td>
</tr>
<tr>
  <th>host_verifications_num</th> <td>    0.0268</td> <td>    0.009</td> <td>    2.957</td> <td> 0.003</td> <td>    0.009</td> <td>    0.045</td>
</tr>
<tr>
  <th>amenities_num</th>          <td>    0.0037</td> <td>    0.000</td> <td>   11.325</td> <td> 0.000</td> <td>    0.003</td> <td>    0.004</td>
</tr>
<tr>
  <th>host_duration</th>          <td>-6.905e-06</td> <td> 4.09e-06</td> <td>   -1.687</td> <td> 0.092</td> <td>-1.49e-05</td> <td> 1.12e-06</td>
</tr>
<tr>
  <th>popularity</th>             <td>   -0.0383</td> <td>    0.003</td> <td>  -12.697</td> <td> 0.000</td> <td>   -0.044</td> <td>   -0.032</td>
</tr>
<tr>
  <th>dist_attractions</th>       <td>-1.347e-05</td> <td> 3.06e-06</td> <td>   -4.404</td> <td> 0.000</td> <td>-1.95e-05</td> <td>-7.47e-06</td>
</tr>
<tr>
  <th>dist_city</th>              <td> -6.89e-06</td> <td> 1.54e-06</td> <td>   -4.461</td> <td> 0.000</td> <td>-9.92e-06</td> <td>-3.86e-06</td>
</tr>
<tr>
  <th>average_price</th>          <td>    0.0020</td> <td> 9.98e-05</td> <td>   19.902</td> <td> 0.000</td> <td>    0.002</td> <td>    0.002</td>
</tr>
<tr>
  <th>poi_count</th>              <td>    0.0004</td> <td> 3.97e-05</td> <td>   11.227</td> <td> 0.000</td> <td>    0.000</td> <td>    0.001</td>
</tr>
<tr>
  <th>transport_count</th>        <td>    0.0004</td> <td>    0.001</td> <td>    0.682</td> <td> 0.495</td> <td>   -0.001</td> <td>    0.002</td>
</tr>
<tr>
  <th>host_is_superhost_t</th>    <td>    0.0391</td> <td>    0.009</td> <td>    4.399</td> <td> 0.000</td> <td>    0.022</td> <td>    0.057</td>
</tr>
<tr>
  <th>instant_bookable_t</th>     <td>    0.0037</td> <td>    0.008</td> <td>    0.443</td> <td> 0.658</td> <td>   -0.013</td> <td>    0.020</td>
</tr>
<tr>
  <th>license_tf_t</th>           <td>    0.1161</td> <td>    0.010</td> <td>   11.314</td> <td> 0.000</td> <td>    0.096</td> <td>    0.136</td>
</tr>
<tr>
  <th>host_location_tf_t</th>     <td>   -0.0379</td> <td>    0.010</td> <td>   -3.704</td> <td> 0.000</td> <td>   -0.058</td> <td>   -0.018</td>
</tr>
</tbody></table>
<table class="simpletable">
<tbody><tr>
  <th>Omnibus:</th>       <td>45.247</td> <th>  Durbin-Watson:     </th> <td>   1.874</td>
</tr>
<tr>
  <th>Prob(Omnibus):</th> <td> 0.000</td> <th>  Jarque-Bera (JB):  </th> <td>  30.317</td>
</tr>
<tr>
  <th>Skew:</th>          <td> 0.052</td> <th>  Prob(JB):          </th> <td>2.61e-07</td>
</tr>
<tr>
  <th>Kurtosis:</th>      <td> 2.620</td> <th>  Cond. No.          </th> <td>1.52e+05</td>
</tr>
</tbody></table><br><br>Notes:<br>[1] Standard Errors assume that the covariance matrix of the errors is correctly specified.<br>[2] The condition number is large, 1.52e+05. This might indicate that there are<br>strong multicollinearity or other numerical problems.
</div>
</div>
<div class="cell" data-notebookrungroups="{&quot;groupValue&quot;:&quot;&quot;}" data-execution_count="118">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Contributor: Xianlai Yin</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a><span class="co">#回归拟合</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">8</span>,<span class="dv">8</span>))</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>predict <span class="op">=</span> OLS1_price.fittedvalues</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>pd.DataFrame({<span class="st">"Prediction"</span>:predict,<span class="st">"Real"</span>:OLS1_y})</span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>plt.scatter(x <span class="op">=</span> OLS1_y, y <span class="op">=</span> predict) </span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>plt.plot([OLS1_y.<span class="bu">min</span>(),OLS1_y.<span class="bu">max</span>()],[OLS1_y.<span class="bu">min</span>(),OLS1_y.<span class="bu">max</span>()],color <span class="op">=</span> <span class="st">"red"</span>, linestyle <span class="op">=</span> <span class="st">"--"</span>)</span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a><span class="co">'''</span></span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a><span class="co">#输出影响显著且解释度&gt;5%的一元线性回归图和影响显著的值</span></span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a><span class="co">def rm(indep):</span></span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a><span class="co">    rm = sm.OLS(endog = none_outliers['price_log'], exog = sm.add_constant(none_outliers[indep])).fit()</span></span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a><span class="co">    beta_0, beta_1 = rm.params</span></span>
<span id="cb18-16"><a href="#cb18-16" aria-hidden="true" tabindex="-1"></a><span class="co">    rsq    = rm.rsquared</span></span>
<span id="cb18-17"><a href="#cb18-17" aria-hidden="true" tabindex="-1"></a><span class="co">    pval_0, pval_1 = rm.pvalues</span></span>
<span id="cb18-18"><a href="#cb18-18" aria-hidden="true" tabindex="-1"></a><span class="co">    if rsq &gt; 0.05 and pval_1 &lt; 0.05:</span></span>
<span id="cb18-19"><a href="#cb18-19" aria-hidden="true" tabindex="-1"></a><span class="co">        fig, ax = plt.subplots()</span></span>
<span id="cb18-20"><a href="#cb18-20" aria-hidden="true" tabindex="-1"></a><span class="co">        none_outliers.plot(kind='scatter', x=indep, y='price_log', figsize=(9, 9), ax = ax)</span></span>
<span id="cb18-21"><a href="#cb18-21" aria-hidden="true" tabindex="-1"></a><span class="co">        X = none_outliers.eval(indep)</span></span>
<span id="cb18-22"><a href="#cb18-22" aria-hidden="true" tabindex="-1"></a><span class="co">        b = plt.plot(X, X*beta_1 + beta_0, 'r')</span></span>
<span id="cb18-23"><a href="#cb18-23" aria-hidden="true" tabindex="-1"></a><span class="co">    if pval_1 &lt; 0.05:</span></span>
<span id="cb18-24"><a href="#cb18-24" aria-hidden="true" tabindex="-1"></a><span class="co">        print(indep)</span></span>
<span id="cb18-25"><a href="#cb18-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-26"><a href="#cb18-26" aria-hidden="true" tabindex="-1"></a><span class="co">indepdent = none_outliers.columns</span></span>
<span id="cb18-27"><a href="#cb18-27" aria-hidden="true" tabindex="-1"></a><span class="co">for i in range(len(indepdent)):</span></span>
<span id="cb18-28"><a href="#cb18-28" aria-hidden="true" tabindex="-1"></a><span class="co">    rm(indep = indepdent[i])</span></span>
<span id="cb18-29"><a href="#cb18-29" aria-hidden="true" tabindex="-1"></a><span class="co">'''</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="Spatial_files/figure-html/cell-11-output-1.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display" data-execution_count="118">
<pre><code>"\n#输出影响显著且解释度&gt;5%的一元线性回归图和影响显著的值\ndef rm(indep):\n    rm = sm.OLS(endog = none_outliers['price_log'], exog = sm.add_constant(none_outliers[indep])).fit()\n    beta_0, beta_1 = rm.params\n    rsq    = rm.rsquared\n    pval_0, pval_1 = rm.pvalues\n    if rsq &gt; 0.05 and pval_1 &lt; 0.05:\n        fig, ax = plt.subplots()\n        none_outliers.plot(kind='scatter', x=indep, y='price_log', figsize=(9, 9), ax = ax)\n        X = none_outliers.eval(indep)\n        b = plt.plot(X, X*beta_1 + beta_0, 'r')\n    if pval_1 &lt; 0.05:\n        print(indep)\n\nindepdent = none_outliers.columns\nfor i in range(len(indepdent)):\n    rm(indep = indepdent[i])\n"</code></pre>
</div>
</div>
<div class="cell" data-execution_count="119">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Contributor: Danming Cao</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a><span class="co">#对回归系数进行标准化和排序</span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>feature_imp <span class="op">=</span> OLS1_price.params.iloc[<span class="dv">1</span>:]</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>feature_imp.<span class="bu">abs</span>().sort_values()</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a><span class="co">#Plot</span></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>plt.figure(dpi<span class="op">=</span><span class="dv">200</span>)</span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>sn.barplot(x <span class="op">=</span> feature_imp.index,y <span class="op">=</span> feature_imp.values)</span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>plt.xticks(rotation<span class="op">=</span><span class="dv">90</span>)</span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a><span class="co"># 选择影响最大的五项和最小的三项，影响最小的三个只需要简单描述，影响最大的五个后面会更细化的讨论</span></span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a><span class="co"># 最小的三项</span></span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="bu">sorted</span>(feature_imp,key<span class="op">=</span><span class="bu">abs</span>))</span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a>imp_min <span class="op">=</span> feature_imp.<span class="bu">abs</span>().sort_values().head(<span class="dv">3</span>).index.to_list()</span>
<span id="cb20-16"><a href="#cb20-16" aria-hidden="true" tabindex="-1"></a>imp_max <span class="op">=</span> feature_imp.<span class="bu">abs</span>().sort_values().tail(<span class="dv">5</span>).index.to_list()</span>
<span id="cb20-17"><a href="#cb20-17" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(imp_min)</span>
<span id="cb20-18"><a href="#cb20-18" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(imp_max)</span>
<span id="cb20-19"><a href="#cb20-19" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(feature_imp)</span>
<span id="cb20-20"><a href="#cb20-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-21"><a href="#cb20-21" aria-hidden="true" tabindex="-1"></a><span class="co">#type_num</span></span>
<span id="cb20-22"><a href="#cb20-22" aria-hidden="true" tabindex="-1"></a><span class="co">#不同房间类型的数量</span></span>
<span id="cb20-23"><a href="#cb20-23" aria-hidden="true" tabindex="-1"></a>type_num <span class="op">=</span> none_outliers[<span class="st">'type_num'</span>].value_counts()</span>
<span id="cb20-24"><a href="#cb20-24" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(type_num)</span>
<span id="cb20-25"><a href="#cb20-25" aria-hidden="true" tabindex="-1"></a><span class="co">#将每种房间类型的统计数量转化成百分比形式</span></span>
<span id="cb20-26"><a href="#cb20-26" aria-hidden="true" tabindex="-1"></a>type_num <span class="op">=</span> none_outliers.groupby(<span class="st">'type_num'</span>).size() <span class="op">/</span> none_outliers[<span class="st">'type_num'</span>].count() <span class="op">*</span> <span class="dv">100</span></span>
<span id="cb20-27"><a href="#cb20-27" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(type_num)</span>
<span id="cb20-28"><a href="#cb20-28" aria-hidden="true" tabindex="-1"></a><span class="co">#绘制直方图查看房型数量</span></span>
<span id="cb20-29"><a href="#cb20-29" aria-hidden="true" tabindex="-1"></a>sn.catplot(x <span class="op">=</span> <span class="st">'type_num'</span>,  kind<span class="op">=</span><span class="st">'count'</span>, data <span class="op">=</span> none_outliers)</span>
<span id="cb20-30"><a href="#cb20-30" aria-hidden="true" tabindex="-1"></a>fig <span class="op">=</span> plt.gca()</span>
<span id="cb20-31"><a href="#cb20-31" aria-hidden="true" tabindex="-1"></a>fig.<span class="bu">set</span>()</span>
<span id="cb20-32"><a href="#cb20-32" aria-hidden="true" tabindex="-1"></a><span class="co">#price与type_num数量的关系</span></span>
<span id="cb20-33"><a href="#cb20-33" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>,<span class="dv">9</span>),dpi<span class="op">=</span><span class="dv">200</span>)</span>
<span id="cb20-34"><a href="#cb20-34" aria-hidden="true" tabindex="-1"></a>sn.catplot(<span class="st">'type_num'</span>,<span class="st">'price'</span>,data<span class="op">=</span>listings_data,height<span class="op">=</span><span class="dv">8</span>, aspect<span class="op">=</span><span class="fl">1.5</span>)</span>
<span id="cb20-35"><a href="#cb20-35" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb20-36"><a href="#cb20-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-37"><a href="#cb20-37" aria-hidden="true" tabindex="-1"></a><span class="co">#bathrooms</span></span>
<span id="cb20-38"><a href="#cb20-38" aria-hidden="true" tabindex="-1"></a>bathrooms <span class="op">=</span> none_outliers[<span class="st">'bathrooms'</span>].value_counts()</span>
<span id="cb20-39"><a href="#cb20-39" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(bathrooms)</span>
<span id="cb20-40"><a href="#cb20-40" aria-hidden="true" tabindex="-1"></a><span class="co">#price与bathrooms数量的关系</span></span>
<span id="cb20-41"><a href="#cb20-41" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>,<span class="dv">9</span>),dpi<span class="op">=</span><span class="dv">200</span>)</span>
<span id="cb20-42"><a href="#cb20-42" aria-hidden="true" tabindex="-1"></a>sn.catplot(data<span class="op">=</span> none_outliers,x<span class="op">=</span><span class="st">'bathrooms'</span>,y<span class="op">=</span><span class="st">'price'</span>,height<span class="op">=</span><span class="dv">8</span>, aspect<span class="op">=</span><span class="fl">1.5</span>)</span>
<span id="cb20-43"><a href="#cb20-43" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb20-44"><a href="#cb20-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-45"><a href="#cb20-45" aria-hidden="true" tabindex="-1"></a><span class="co">#bedrooms</span></span>
<span id="cb20-46"><a href="#cb20-46" aria-hidden="true" tabindex="-1"></a>bedrooms <span class="op">=</span> none_outliers[<span class="st">'bedrooms'</span>].value_counts()</span>
<span id="cb20-47"><a href="#cb20-47" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(bedrooms)</span>
<span id="cb20-48"><a href="#cb20-48" aria-hidden="true" tabindex="-1"></a><span class="co">#price与bedrooms数量的关系</span></span>
<span id="cb20-49"><a href="#cb20-49" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>,<span class="dv">9</span>),dpi<span class="op">=</span><span class="dv">200</span>)</span>
<span id="cb20-50"><a href="#cb20-50" aria-hidden="true" tabindex="-1"></a>sn.catplot(data <span class="op">=</span> none_outliers,x<span class="op">=</span><span class="st">'bedrooms'</span>,y<span class="op">=</span><span class="st">'price'</span>,height<span class="op">=</span><span class="dv">8</span>, aspect<span class="op">=</span><span class="fl">1.5</span>)</span>
<span id="cb20-51"><a href="#cb20-51" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb20-52"><a href="#cb20-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-53"><a href="#cb20-53" aria-hidden="true" tabindex="-1"></a><span class="co">#license_tf_t</span></span>
<span id="cb20-54"><a href="#cb20-54" aria-hidden="true" tabindex="-1"></a><span class="co">#不同房间类型的数量</span></span>
<span id="cb20-55"><a href="#cb20-55" aria-hidden="true" tabindex="-1"></a>license_tf_t <span class="op">=</span> none_outliers[<span class="st">'license_tf_t'</span>].value_counts()</span>
<span id="cb20-56"><a href="#cb20-56" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(license_tf_t)</span>
<span id="cb20-57"><a href="#cb20-57" aria-hidden="true" tabindex="-1"></a><span class="co">#将每种房间类型的统计数量转化成百分比形式</span></span>
<span id="cb20-58"><a href="#cb20-58" aria-hidden="true" tabindex="-1"></a>license_tf_t <span class="op">=</span> none_outliers.groupby(<span class="st">'license_tf_t'</span>).size() <span class="op">/</span> none_outliers[<span class="st">'license_tf_t'</span>].count() <span class="op">*</span> <span class="dv">100</span></span>
<span id="cb20-59"><a href="#cb20-59" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(license_tf_t)</span>
<span id="cb20-60"><a href="#cb20-60" aria-hidden="true" tabindex="-1"></a><span class="co">#绘制直方图查看房型数量</span></span>
<span id="cb20-61"><a href="#cb20-61" aria-hidden="true" tabindex="-1"></a>sn.catplot(x <span class="op">=</span> <span class="st">'license_tf_t'</span>,  kind<span class="op">=</span><span class="st">'count'</span>, data <span class="op">=</span> none_outliers)</span>
<span id="cb20-62"><a href="#cb20-62" aria-hidden="true" tabindex="-1"></a>fig <span class="op">=</span> plt.gca()</span>
<span id="cb20-63"><a href="#cb20-63" aria-hidden="true" tabindex="-1"></a>fig.<span class="bu">set</span>()</span>
<span id="cb20-64"><a href="#cb20-64" aria-hidden="true" tabindex="-1"></a><span class="co">#price与license_tf_t数量的关系</span></span>
<span id="cb20-65"><a href="#cb20-65" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>,<span class="dv">9</span>),dpi<span class="op">=</span><span class="dv">200</span>)</span>
<span id="cb20-66"><a href="#cb20-66" aria-hidden="true" tabindex="-1"></a>sn.catplot(data<span class="op">=</span> listings_data,x<span class="op">=</span><span class="st">'license_tf_t'</span>,y<span class="op">=</span><span class="st">'price'</span>,height<span class="op">=</span><span class="dv">8</span>, aspect<span class="op">=</span><span class="fl">1.5</span>)</span>
<span id="cb20-67"><a href="#cb20-67" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb20-68"><a href="#cb20-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-69"><a href="#cb20-69" aria-hidden="true" tabindex="-1"></a><span class="co">#review_scores_rating</span></span>
<span id="cb20-70"><a href="#cb20-70" aria-hidden="true" tabindex="-1"></a>review_scores_rating <span class="op">=</span> none_outliers[<span class="st">'review_scores_rating'</span>].value_counts()</span>
<span id="cb20-71"><a href="#cb20-71" aria-hidden="true" tabindex="-1"></a><span class="co">#review_scores_rating和price的散点图</span></span>
<span id="cb20-72"><a href="#cb20-72" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">300</span>,<span class="dv">9</span>),dpi<span class="op">=</span><span class="dv">200</span>)</span>
<span id="cb20-73"><a href="#cb20-73" aria-hidden="true" tabindex="-1"></a>sn.catplot(data<span class="op">=</span>none_outliers,x <span class="op">=</span> <span class="st">'price'</span>,y <span class="op">=</span> <span class="st">'review_scores_rating'</span>,height<span class="op">=</span><span class="dv">8</span>, aspect<span class="op">=</span><span class="fl">1.5</span>)</span>
<span id="cb20-74"><a href="#cb20-74" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb20-75"><a href="#cb20-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-76"><a href="#cb20-76" aria-hidden="true" tabindex="-1"></a><span class="co">#dist_attractions</span></span>
<span id="cb20-77"><a href="#cb20-77" aria-hidden="true" tabindex="-1"></a>dist_attractions <span class="op">=</span> none_outliers[<span class="st">'dist_attractions'</span>].value_counts()</span>
<span id="cb20-78"><a href="#cb20-78" aria-hidden="true" tabindex="-1"></a><span class="co">#绘制dist_attrctions和price关系的散点图</span></span>
<span id="cb20-79"><a href="#cb20-79" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">300</span>,<span class="dv">9</span>),dpi<span class="op">=</span><span class="dv">200</span>)</span>
<span id="cb20-80"><a href="#cb20-80" aria-hidden="true" tabindex="-1"></a>sn.catplot(data<span class="op">=</span>none_outliers,x <span class="op">=</span> <span class="st">'price'</span>,y <span class="op">=</span> <span class="st">'dist_attractions'</span>,height<span class="op">=</span><span class="dv">8</span>, aspect<span class="op">=</span><span class="fl">1.5</span>)</span>
<span id="cb20-81"><a href="#cb20-81" aria-hidden="true" tabindex="-1"></a>plt.show() </span>
<span id="cb20-82"><a href="#cb20-82" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-83"><a href="#cb20-83" aria-hidden="true" tabindex="-1"></a><span class="co">#dist_city</span></span>
<span id="cb20-84"><a href="#cb20-84" aria-hidden="true" tabindex="-1"></a>dist_attractions <span class="op">=</span> none_outliers[<span class="st">'dist_city'</span>].value_counts()</span>
<span id="cb20-85"><a href="#cb20-85" aria-hidden="true" tabindex="-1"></a><span class="co">#绘制dist_city和price关系的散点图</span></span>
<span id="cb20-86"><a href="#cb20-86" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">300</span>,<span class="dv">9</span>),dpi<span class="op">=</span><span class="dv">200</span>)</span>
<span id="cb20-87"><a href="#cb20-87" aria-hidden="true" tabindex="-1"></a>sn.catplot(data<span class="op">=</span>none_outliers,x <span class="op">=</span> <span class="st">'price'</span>,y <span class="op">=</span> <span class="st">'dist_city'</span>,height<span class="op">=</span><span class="dv">8</span>, aspect<span class="op">=</span><span class="fl">1.5</span>)</span>
<span id="cb20-88"><a href="#cb20-88" aria-hidden="true" tabindex="-1"></a>plt.show() </span>
<span id="cb20-89"><a href="#cb20-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-90"><a href="#cb20-90" aria-hidden="true" tabindex="-1"></a><span class="co">#host_duration</span></span>
<span id="cb20-91"><a href="#cb20-91" aria-hidden="true" tabindex="-1"></a>dist_attractions <span class="op">=</span> none_outliers[<span class="st">'host_duration'</span>].value_counts()</span>
<span id="cb20-92"><a href="#cb20-92" aria-hidden="true" tabindex="-1"></a><span class="co">#绘制host_duration和price关系的散点图</span></span>
<span id="cb20-93"><a href="#cb20-93" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">300</span>,<span class="dv">9</span>),dpi<span class="op">=</span><span class="dv">200</span>)</span>
<span id="cb20-94"><a href="#cb20-94" aria-hidden="true" tabindex="-1"></a>sn.catplot(data<span class="op">=</span>none_outliers,x <span class="op">=</span> <span class="st">'price'</span>,y <span class="op">=</span> <span class="st">'host_duration'</span>,height<span class="op">=</span><span class="dv">8</span>, aspect<span class="op">=</span><span class="fl">1.5</span>)</span>
<span id="cb20-95"><a href="#cb20-95" aria-hidden="true" tabindex="-1"></a>plt.show() </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="Spatial_files/figure-html/cell-12-output-1.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[-6.89044602854377e-06, -6.9051568240551415e-06, -1.3470433223586126e-05, -3.838604773483103e-05, 0.0004320583885762065, 0.00044572528297605763, -0.0005742738956457904, 0.001985853743682958, 0.003698843432590916, 0.003706030660876769, 0.017179428616621226, 0.026826816289361274, -0.0378767984092232, -0.0383241730306092, 0.0391372895707303, 0.0443104479967104, 0.09812983773397604, 0.1161363525437712, 0.12649653491259588, 0.13064120330374457, 0.4107462862953241]
['dist_city', 'host_duration', 'dist_attractions']
['review_scores_rating', 'license_tf_t', 'bedrooms', 'bathrooms', 'type_num']
host_acceptance_rate     -0.000574
accommodates              0.044310
bathrooms                 0.130641
bedrooms                  0.126497
maximum_nights_avg_ntm   -0.000038
review_scores_rating      0.098130
response_time_num         0.017179
type_num                  0.410746
host_verifications_num    0.026827
amenities_num             0.003699
host_duration            -0.000007
popularity               -0.038324
dist_attractions         -0.000013
dist_city                -0.000007
average_price             0.001986
poi_count                 0.000446
transport_count           0.000432
host_is_superhost_t       0.039137
instant_bookable_t        0.003706
license_tf_t              0.116136
host_location_tf_t       -0.037877
dtype: float64
3    4015
2     670
1      10
Name: type_num, dtype: int64
type_num
1     0.212993
2    14.270501
3    85.516507
dtype: float64
1.0    3304
2.0     636
1.5     270
2.5     235
3.0     132
3.5      90
4.0      14
0.5       5
4.5       4
0.0       4
6.0       1
Name: bathrooms, dtype: int64</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="Spatial_files/figure-html/cell-12-output-3.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<pre><code>&lt;Figure size 2000x1800 with 0 Axes&gt;</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="Spatial_files/figure-html/cell-12-output-5.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>1.0    2259
2.0    1120
3.0     556
0.0     502
4.0     162
5.0      69
6.0      18
7.0       8
8.0       1
Name: bedrooms, dtype: int64</code></pre>
</div>
<div class="cell-output cell-output-display">
<pre><code>&lt;Figure size 2000x1800 with 0 Axes&gt;</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="Spatial_files/figure-html/cell-12-output-8.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>1    3703
0     992
Name: license_tf_t, dtype: int64
license_tf_t
0    21.12886
1    78.87114
dtype: float64</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="Spatial_files/figure-html/cell-12-output-10.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<pre><code>&lt;Figure size 60000x1800 with 0 Axes&gt;</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="Spatial_files/figure-html/cell-12-output-12.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<pre><code>&lt;Figure size 60000x1800 with 0 Axes&gt;</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="Spatial_files/figure-html/cell-12-output-14.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<pre><code>&lt;Figure size 60000x1800 with 0 Axes&gt;</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="Spatial_files/figure-html/cell-12-output-16.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<pre><code>&lt;Figure size 60000x1800 with 0 Axes&gt;</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="Spatial_files/figure-html/cell-12-output-18.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="120">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Contributor: Danming Cao</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a><span class="co">#Scatter plot of influencing factors significantly related to price</span></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>fig,ax<span class="op">=</span>plt.subplots(<span class="dv">1</span>,<span class="dv">5</span>,figsize<span class="op">=</span>(<span class="dv">23</span>,<span class="dv">5</span>))</span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">0</span>].scatter(x <span class="op">=</span> none_outliers[<span class="st">'type_num'</span>],y <span class="op">=</span> none_outliers[<span class="st">'price'</span>],alpha<span class="op">=</span><span class="fl">.5</span>)</span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">0</span>].set_xlabel(xlabel <span class="op">=</span> <span class="st">'type_num'</span>)</span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">0</span>].set_ylabel(ylabel <span class="op">=</span> <span class="st">'price'</span>)</span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">1</span>].scatter(x <span class="op">=</span> none_outliers[<span class="st">'license_tf_t'</span>],y <span class="op">=</span> none_outliers[<span class="st">'price'</span>],alpha <span class="op">=</span> <span class="fl">.5</span>)</span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">1</span>].set_xlabel(xlabel<span class="op">=</span><span class="st">'license_tf_t'</span>)</span>
<span id="cb30-12"><a href="#cb30-12" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">1</span>].set_ylabel(ylabel<span class="op">=</span><span class="st">''</span>)</span>
<span id="cb30-13"><a href="#cb30-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-14"><a href="#cb30-14" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">2</span>].scatter(x <span class="op">=</span> none_outliers[<span class="st">'bathrooms'</span>],y <span class="op">=</span> none_outliers[<span class="st">'price'</span>],alpha <span class="op">=</span> <span class="fl">.5</span>)</span>
<span id="cb30-15"><a href="#cb30-15" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">2</span>].set_xlabel(xlabel <span class="op">=</span> <span class="st">'bathrooms'</span>)</span>
<span id="cb30-16"><a href="#cb30-16" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">2</span>].set_ylabel(ylabel <span class="op">=</span> <span class="st">''</span>)</span>
<span id="cb30-17"><a href="#cb30-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-18"><a href="#cb30-18" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">3</span>].scatter(x <span class="op">=</span> none_outliers[<span class="st">'bedrooms'</span>],y <span class="op">=</span> none_outliers[<span class="st">'price'</span>],alpha <span class="op">=</span> <span class="fl">.5</span>)</span>
<span id="cb30-19"><a href="#cb30-19" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">3</span>].set_xlabel(xlabel <span class="op">=</span> <span class="st">'bedrooms'</span>)</span>
<span id="cb30-20"><a href="#cb30-20" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">3</span>].set_ylabel(ylabel <span class="op">=</span> <span class="st">''</span>)</span>
<span id="cb30-21"><a href="#cb30-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-22"><a href="#cb30-22" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">4</span>].scatter(x <span class="op">=</span> none_outliers[<span class="st">'review_scores_rating'</span>],y <span class="op">=</span> none_outliers[<span class="st">'price'</span>],alpha<span class="op">=</span><span class="fl">.5</span>)</span>
<span id="cb30-23"><a href="#cb30-23" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">4</span>].set_xlabel(xlabel <span class="op">=</span> <span class="st">'review_scores_rating'</span>)</span>
<span id="cb30-24"><a href="#cb30-24" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">4</span>].set_ylabel(ylabel <span class="op">=</span> <span class="st">''</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="120">
<pre><code>Text(0, 0.5, '')</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="Spatial_files/figure-html/cell-13-output-2.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="121">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Contributor: Danming Cao</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a><span class="co">#Scatter plot of influencing factors insignificantly related to price</span></span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>fig,ax<span class="op">=</span>plt.subplots(<span class="dv">1</span>,<span class="dv">3</span>,figsize<span class="op">=</span>(<span class="dv">15</span>,<span class="dv">5</span>))</span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">0</span>].scatter(x <span class="op">=</span> none_outliers[<span class="st">'dist_city'</span>],y <span class="op">=</span> none_outliers[<span class="st">'price'</span>],alpha<span class="op">=</span><span class="fl">.5</span>)</span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">0</span>].set_xlabel(xlabel <span class="op">=</span> <span class="st">'dist_city'</span>)</span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">0</span>].set_ylabel(ylabel <span class="op">=</span> <span class="st">'price'</span>)</span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">1</span>].scatter(x <span class="op">=</span> none_outliers[<span class="st">'host_duration'</span>],y <span class="op">=</span> none_outliers[<span class="st">'price'</span>],alpha <span class="op">=</span> <span class="fl">.5</span>)</span>
<span id="cb32-11"><a href="#cb32-11" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">1</span>].set_xlabel(xlabel<span class="op">=</span><span class="st">'host_duration'</span>)</span>
<span id="cb32-12"><a href="#cb32-12" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">1</span>].set_ylabel(ylabel<span class="op">=</span><span class="st">''</span>)</span>
<span id="cb32-13"><a href="#cb32-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-14"><a href="#cb32-14" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">2</span>].scatter(x <span class="op">=</span> none_outliers[<span class="st">'dist_attractions'</span>],y <span class="op">=</span> none_outliers[<span class="st">'price'</span>],alpha <span class="op">=</span> <span class="fl">.5</span>)</span>
<span id="cb32-15"><a href="#cb32-15" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">2</span>].set_xlabel(xlabel <span class="op">=</span> <span class="st">'dist_attractions'</span>)</span>
<span id="cb32-16"><a href="#cb32-16" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">2</span>].set_ylabel(ylabel <span class="op">=</span> <span class="st">''</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="121">
<pre><code>Text(0, 0.5, '')</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="Spatial_files/figure-html/cell-14-output-2.png" class="img-fluid"></p>
</div>
</div>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    setTimeout(function() {
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const cites = ref.parentNode.getAttribute('data-cites').split(' ');
    tippyHover(ref, function() {
      var popup = window.document.createElement('div');
      cites.forEach(function(cite) {
        var citeDiv = window.document.createElement('div');
        citeDiv.classList.add('hanging-indent');
        citeDiv.classList.add('csl-entry');
        var biblioDiv = window.document.getElementById('ref-' + cite);
        if (biblioDiv) {
          citeDiv.innerHTML = biblioDiv.innerHTML;
        }
        popup.appendChild(citeDiv);
      });
      return popup.innerHTML;
    });
  }
});
</script>
</div> <!-- /content -->



</body></html>